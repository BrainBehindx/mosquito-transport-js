
/**
* @license
*
* The MIT License (MIT)
* 
* Copyright 2024 BrainbehindX Inc.
*  
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
* THE SOFTWARE.
*/

"use strict";var e=require("buffer"),t=require("crypto"),r=require("fs"),n=require("url"),i=require("child_process"),s=require("http"),o=require("https"),a=require("stream"),c=require("zlib"),h=require("net"),l=require("tls"),u=require("events");function f(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}class d{constructor(){this.listenerMap={},this.lastTriggerValueMap={},this.triggeredKeys={}}listenTo(e,t,r=!1){if("function"!=typeof t)throw`expected a function in listenTo() second argument "${t}"`;if("boolean"!=typeof r)throw`expected a boolean in listenTo() third argument but got "${r}"`;this.listenerMap[e]||(this.listenerMap[e]={ite:0,triggers:{}});const n=""+ ++this.listenerMap[e].ite;let i;return this.listenerMap[e].triggers[n]=t,r&&setTimeout((()=>{i||t?.(...this.lastTriggerValueMap[e]||[])}),0),()=>{i||(delete this.listenerMap[e].triggers[n],Object.keys(this.listenerMap[e].triggers).length||delete this.listenerMap[e]),i=!0}}hasDispatched(e){return!!this.triggeredKeys[e]}deleteDispatch(e){this.lastTriggerValueMap[e]&&delete this.lastTriggerValueMap[e],this.triggeredKeys[e]&&delete this.triggeredKeys[e]}dispatch(){const e=[...arguments||[]],t=e[0],r=e.filter(((e,t)=>t));if(!t)throw`expected a string in dispatch() first argument but got "${t}"`;Object.keys(this.listenerMap[t]?.triggers||{}).forEach((e=>{this.listenerMap[t]?.triggers[e]?.(...r)})),this.lastTriggerValueMap[t]=r,this.triggeredKeys[t]=!0}}const p=new d,y=new d,_=new d,g=new d,m=new d;var b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function w(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var E={exports:{}};function k(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var S,A={exports:{}};function T(){return S||(S=1,A.exports=(e=e||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==b&&b.crypto&&(r=b.crypto),!r)try{r=require("crypto")}catch(e){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),s={},o=s.lib={},a=o.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=o.WordArray=a.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var s=0;s<i;s++){var o=r[s>>>2]>>>24-s%4*8&255;t[n+s>>>2]|=o<<24-(n+s)%4*8}else for(var a=0;a<i;a+=4)t[n+a>>>2]=r[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new c.init(t,e)}}),h=s.enc={},l=h.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var s=t[i>>>2]>>>24-i%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},u=h.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var s=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(s))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},f=h.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},d=o.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,s=n.sigBytes,o=this.blockSize,a=s/(4*o),h=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,l=e.min(4*h,s);if(h){for(var u=0;u<h;u+=o)this._doProcessBlock(i,u);r=i.splice(0,h),n.sigBytes-=l}return new c.init(r,l)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=d.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}});var p=s.algo={};return s}(Math),e)),A.exports;var e}var O,x={exports:{}};function C(){return O||(O=1,x.exports=(e=T(),function(){var t=e,r=t.lib.WordArray;function n(e,t,n){for(var i=[],s=0,o=0;o<t;o++)if(o%4){var a=n[e.charCodeAt(o-1)]<<o%4*2|n[e.charCodeAt(o)]>>>6-o%4*2;i[s>>>2]|=a<<24-s%4*8,s++}return r.create(i,s)}t.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],s=0;s<r;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<r;a++)i.push(n.charAt(o>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var s=0;s<r.length;s++)i[r.charCodeAt(s)]=s}var o=r.charAt(64);if(o){var a=e.indexOf(o);-1!==a&&(t=a)}return n(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64)),x.exports;var e}var N,R={exports:{}};function $(){return N||(N=1,R.exports=(e=T(),function(t){var r=e,n=r.lib,i=n.WordArray,s=n.Hasher,o=r.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var c=o.MD5=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s=this._hash.words,o=e[t+0],c=e[t+1],d=e[t+2],p=e[t+3],y=e[t+4],_=e[t+5],g=e[t+6],m=e[t+7],v=e[t+8],b=e[t+9],w=e[t+10],E=e[t+11],k=e[t+12],S=e[t+13],A=e[t+14],T=e[t+15],O=s[0],x=s[1],C=s[2],N=s[3];O=h(O,x,C,N,o,7,a[0]),N=h(N,O,x,C,c,12,a[1]),C=h(C,N,O,x,d,17,a[2]),x=h(x,C,N,O,p,22,a[3]),O=h(O,x,C,N,y,7,a[4]),N=h(N,O,x,C,_,12,a[5]),C=h(C,N,O,x,g,17,a[6]),x=h(x,C,N,O,m,22,a[7]),O=h(O,x,C,N,v,7,a[8]),N=h(N,O,x,C,b,12,a[9]),C=h(C,N,O,x,w,17,a[10]),x=h(x,C,N,O,E,22,a[11]),O=h(O,x,C,N,k,7,a[12]),N=h(N,O,x,C,S,12,a[13]),C=h(C,N,O,x,A,17,a[14]),O=l(O,x=h(x,C,N,O,T,22,a[15]),C,N,c,5,a[16]),N=l(N,O,x,C,g,9,a[17]),C=l(C,N,O,x,E,14,a[18]),x=l(x,C,N,O,o,20,a[19]),O=l(O,x,C,N,_,5,a[20]),N=l(N,O,x,C,w,9,a[21]),C=l(C,N,O,x,T,14,a[22]),x=l(x,C,N,O,y,20,a[23]),O=l(O,x,C,N,b,5,a[24]),N=l(N,O,x,C,A,9,a[25]),C=l(C,N,O,x,p,14,a[26]),x=l(x,C,N,O,v,20,a[27]),O=l(O,x,C,N,S,5,a[28]),N=l(N,O,x,C,d,9,a[29]),C=l(C,N,O,x,m,14,a[30]),O=u(O,x=l(x,C,N,O,k,20,a[31]),C,N,_,4,a[32]),N=u(N,O,x,C,v,11,a[33]),C=u(C,N,O,x,E,16,a[34]),x=u(x,C,N,O,A,23,a[35]),O=u(O,x,C,N,c,4,a[36]),N=u(N,O,x,C,y,11,a[37]),C=u(C,N,O,x,m,16,a[38]),x=u(x,C,N,O,w,23,a[39]),O=u(O,x,C,N,S,4,a[40]),N=u(N,O,x,C,o,11,a[41]),C=u(C,N,O,x,p,16,a[42]),x=u(x,C,N,O,g,23,a[43]),O=u(O,x,C,N,b,4,a[44]),N=u(N,O,x,C,k,11,a[45]),C=u(C,N,O,x,T,16,a[46]),O=f(O,x=u(x,C,N,O,d,23,a[47]),C,N,o,6,a[48]),N=f(N,O,x,C,m,10,a[49]),C=f(C,N,O,x,A,15,a[50]),x=f(x,C,N,O,_,21,a[51]),O=f(O,x,C,N,k,6,a[52]),N=f(N,O,x,C,p,10,a[53]),C=f(C,N,O,x,w,15,a[54]),x=f(x,C,N,O,c,21,a[55]),O=f(O,x,C,N,v,6,a[56]),N=f(N,O,x,C,T,10,a[57]),C=f(C,N,O,x,g,15,a[58]),x=f(x,C,N,O,S,21,a[59]),O=f(O,x,C,N,y,6,a[60]),N=f(N,O,x,C,E,10,a[61]),C=f(C,N,O,x,d,15,a[62]),x=f(x,C,N,O,b,21,a[63]),s[0]=s[0]+O|0,s[1]=s[1]+x|0,s[2]=s[2]+C|0,s[3]=s[3]+N|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;r[i>>>5]|=128<<24-i%32;var s=t.floor(n/4294967296),o=n;r[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r[14+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,c=a.words,h=0;h<4;h++){var l=c[h];c[h]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,r,n,i,s,o){var a=e+(t&r|~t&n)+i+o;return(a<<s|a>>>32-s)+t}function l(e,t,r,n,i,s,o){var a=e+(t&n|r&~n)+i+o;return(a<<s|a>>>32-s)+t}function u(e,t,r,n,i,s,o){var a=e+(t^r^n)+i+o;return(a<<s|a>>>32-s)+t}function f(e,t,r,n,i,s,o){var a=e+(r^(t|~n))+i+o;return(a<<s|a>>>32-s)+t}r.MD5=s._createHelper(c),r.HmacMD5=s._createHmacHelper(c)}(Math),e.MD5)),R.exports;var e}var P,B={exports:{}},L={exports:{}};function U(){return P||(P=1,L.exports=(a=T(),t=(e=a).lib,r=t.WordArray,n=t.Hasher,i=e.algo,s=[],o=i.SHA1=n.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],c=r[4],h=0;h<80;h++){if(h<16)s[h]=0|e[t+h];else{var l=s[h-3]^s[h-8]^s[h-14]^s[h-16];s[h]=l<<1|l>>>31}var u=(n<<5|n>>>27)+c+s[h];u+=h<20?1518500249+(i&o|~i&a):h<40?1859775393+(i^o^a):h<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,c=a,a=o,o=i<<30|i>>>2,i=n,n=u}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),e.SHA1=n._createHelper(o),e.HmacSHA1=n._createHmacHelper(o),a.SHA1)),L.exports;var e,t,r,n,i,s,o,a}var j,D,M={exports:{}};function I(){return D||(D=1,B.exports=function(e){return function(){var t=e,r=t.lib,n=r.Base,i=r.WordArray,s=t.algo,o=s.MD5,a=s.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,s=n.hasher.create(),o=i.create(),a=o.words,c=n.keySize,h=n.iterations;a.length<c;){r&&s.update(r),r=s.update(e).finalize(t),s.reset();for(var l=1;l<h;l++)r=s.finalize(r),s.reset();o.concat(r)}return o.sigBytes=4*c,o}});t.EvpKDF=function(e,t,r){return a.create(r).compute(e,t)}}(),e.EvpKDF}(T(),U(),(j||(j=1,M.exports=(e=T(),r=(t=e).lib.Base,n=t.enc.Utf8,void(t.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),o=this._iKey=t.clone(),a=s.words,c=o.words,h=0;h<r;h++)a[h]^=1549556828,c[h]^=909522486;s.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))),M.exports))),B.exports;var e,t,r,n}var F,W,q={exports:{}};E.exports=function(e){return function(){var t=e,r=t.lib.BlockCipher,n=t.algo,i=[],s=[],o=[],a=[],c=[],h=[],l=[],u=[],f=[],d=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var p=n^n<<1^n<<2^n<<3^n<<4;p=p>>>8^255&p^99,i[r]=p,s[p]=r;var y=e[r],_=e[y],g=e[_],m=257*e[p]^16843008*p;o[r]=m<<24|m>>>8,a[r]=m<<16|m>>>16,c[r]=m<<8|m>>>24,h[r]=m,m=16843009*g^65537*_^257*y^16843008*r,l[p]=m<<24|m>>>8,u[p]=m<<16|m>>>16,f[p]=m<<8|m>>>24,d[p]=m,r?(r=y^e[e[e[g^y]]],n^=e[e[n]]):r=n=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],y=n.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),s=this._keySchedule=[],o=0;o<n;o++)o<r?s[o]=t[o]:(h=s[o-1],o%r?r>6&&o%r==4&&(h=i[h>>>24]<<24|i[h>>>16&255]<<16|i[h>>>8&255]<<8|i[255&h]):(h=i[(h=h<<8|h>>>24)>>>24]<<24|i[h>>>16&255]<<16|i[h>>>8&255]<<8|i[255&h],h^=p[o/r|0]<<24),s[o]=s[o-r]^h);for(var a=this._invKeySchedule=[],c=0;c<n;c++){if(o=n-c,c%4)var h=s[o];else h=s[o-4];a[c]=c<4||o<=4?h:l[i[h>>>24]]^u[i[h>>>16&255]]^f[i[h>>>8&255]]^d[i[255&h]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,a,c,h,i)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,l,u,f,d,s),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,s,o,a){for(var c=this._nRounds,h=e[t]^r[0],l=e[t+1]^r[1],u=e[t+2]^r[2],f=e[t+3]^r[3],d=4,p=1;p<c;p++){var y=n[h>>>24]^i[l>>>16&255]^s[u>>>8&255]^o[255&f]^r[d++],_=n[l>>>24]^i[u>>>16&255]^s[f>>>8&255]^o[255&h]^r[d++],g=n[u>>>24]^i[f>>>16&255]^s[h>>>8&255]^o[255&l]^r[d++],m=n[f>>>24]^i[h>>>16&255]^s[l>>>8&255]^o[255&u]^r[d++];h=y,l=_,u=g,f=m}y=(a[h>>>24]<<24|a[l>>>16&255]<<16|a[u>>>8&255]<<8|a[255&f])^r[d++],_=(a[l>>>24]<<24|a[u>>>16&255]<<16|a[f>>>8&255]<<8|a[255&h])^r[d++],g=(a[u>>>24]<<24|a[f>>>16&255]<<16|a[h>>>8&255]<<8|a[255&l])^r[d++],m=(a[f>>>24]<<24|a[h>>>16&255]<<16|a[l>>>8&255]<<8|a[255&u])^r[d++],e[t]=y,e[t+1]=_,e[t+2]=g,e[t+3]=m},keySize:8});t.AES=r._createHelper(y)}(),e.AES}(T(),C(),$(),I(),F||(F=1,q.exports=(W=T(),I(),void(W.lib.Cipher||function(e){var t=W,r=t.lib,n=r.Base,i=r.WordArray,s=r.BufferedBlockAlgorithm,o=t.enc;o.Utf8;var a=o.Base64,c=t.algo.EvpKDF,h=r.Cipher=s.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?m:_}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()});r.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var l=t.mode={},u=r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=l.CBC=function(){var t=u.extend();function r(t,r,n){var i,s=this._iv;s?(i=s,this._iv=e):i=this._prevBlock;for(var o=0;o<n;o++)t[r+o]^=i[o]}return t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;r.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),t.Decryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,s=e.slice(t,t+i);n.decryptBlock(e,t),r.call(this,e,t,i),this._prevBlock=s}}),t}(),d=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,s=n<<24|n<<16|n<<8|n,o=[],a=0;a<n;a+=4)o.push(s);var c=i.create(o,n);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};r.BlockCipher=h.extend({cfg:h.cfg.extend({mode:f,padding:d}),reset:function(){var e;h.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var p=r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),y=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?i.create([1398893684,1701076831]).concat(r).concat(t):t).toString(a)},parse:function(e){var t,r=a.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=i.create(n.slice(2,4)),n.splice(0,4),r.sigBytes-=16),p.create({ciphertext:r,salt:t})}},_=r.SerializableCipher=n.extend({cfg:n.extend({format:y}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),s=i.finalize(t),o=i.cfg;return p.create({ciphertext:s,key:r,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),g=(t.kdf={}).OpenSSL={execute:function(e,t,r,n,s){if(n||(n=i.random(8)),s)o=c.create({keySize:t+r,hasher:s}).compute(e,n);else var o=c.create({keySize:t+r}).compute(e,n);var a=i.create(o.words.slice(t),4*r);return o.sigBytes=4*t,p.create({key:o,iv:a,salt:n})}},m=r.PasswordBasedCipher=_.extend({cfg:_.cfg.extend({kdf:g}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize,n.salt,n.hasher);n.iv=i.iv;var s=_.encrypt.call(this,e,t,i.key,n);return s.mixIn(i),s},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt,n.hasher);return n.iv=i.iv,_.decrypt.call(this,e,t,i.key,n)}})}()))));var K=w(E.exports),z={exports:{}};z.exports=function(e){return e.enc.Utf8}(T());var H=w(z.exports),V={exports:{}};!function(e){var r=function(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;t++)r[t]=e[t];return r},n=function(){throw new Error("no PRNG")},i=new Uint8Array(16),s=new Uint8Array(32);s[0]=9;var o=r(),a=r([1]),c=r([56129,1]),h=r([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),l=r([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),u=r([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),f=r([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),d=r([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function p(e,t,r,n){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r,e[t+4]=n>>24&255,e[t+5]=n>>16&255,e[t+6]=n>>8&255,e[t+7]=255&n}function y(e,t,r,n,i){var s,o=0;for(s=0;s<i;s++)o|=e[t+s]^r[n+s];return(1&o-1>>>8)-1}function _(e,t,r,n){return y(e,t,r,n,16)}function g(e,t,r,n){return y(e,t,r,n,32)}function m(e,t,r,n){!function(e,t,r,n){for(var i,s=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,h=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,l=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,u=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,f=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,d=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,p=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,y=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,_=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,g=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,m=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,b=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,w=s,E=o,k=a,S=c,A=h,T=l,O=u,x=f,C=d,N=p,R=y,$=_,P=g,B=m,L=v,U=b,j=0;j<20;j+=2)w^=(i=(P^=(i=(C^=(i=(A^=(i=w+P|0)<<7|i>>>25)+w|0)<<9|i>>>23)+A|0)<<13|i>>>19)+C|0)<<18|i>>>14,T^=(i=(E^=(i=(B^=(i=(N^=(i=T+E|0)<<7|i>>>25)+T|0)<<9|i>>>23)+N|0)<<13|i>>>19)+B|0)<<18|i>>>14,R^=(i=(O^=(i=(k^=(i=(L^=(i=R+O|0)<<7|i>>>25)+R|0)<<9|i>>>23)+L|0)<<13|i>>>19)+k|0)<<18|i>>>14,U^=(i=($^=(i=(x^=(i=(S^=(i=U+$|0)<<7|i>>>25)+U|0)<<9|i>>>23)+S|0)<<13|i>>>19)+x|0)<<18|i>>>14,w^=(i=(S^=(i=(k^=(i=(E^=(i=w+S|0)<<7|i>>>25)+w|0)<<9|i>>>23)+E|0)<<13|i>>>19)+k|0)<<18|i>>>14,T^=(i=(A^=(i=(x^=(i=(O^=(i=T+A|0)<<7|i>>>25)+T|0)<<9|i>>>23)+O|0)<<13|i>>>19)+x|0)<<18|i>>>14,R^=(i=(N^=(i=(C^=(i=($^=(i=R+N|0)<<7|i>>>25)+R|0)<<9|i>>>23)+$|0)<<13|i>>>19)+C|0)<<18|i>>>14,U^=(i=(L^=(i=(B^=(i=(P^=(i=U+L|0)<<7|i>>>25)+U|0)<<9|i>>>23)+P|0)<<13|i>>>19)+B|0)<<18|i>>>14;w=w+s|0,E=E+o|0,k=k+a|0,S=S+c|0,A=A+h|0,T=T+l|0,O=O+u|0,x=x+f|0,C=C+d|0,N=N+p|0,R=R+y|0,$=$+_|0,P=P+g|0,B=B+m|0,L=L+v|0,U=U+b|0,e[0]=w>>>0&255,e[1]=w>>>8&255,e[2]=w>>>16&255,e[3]=w>>>24&255,e[4]=E>>>0&255,e[5]=E>>>8&255,e[6]=E>>>16&255,e[7]=E>>>24&255,e[8]=k>>>0&255,e[9]=k>>>8&255,e[10]=k>>>16&255,e[11]=k>>>24&255,e[12]=S>>>0&255,e[13]=S>>>8&255,e[14]=S>>>16&255,e[15]=S>>>24&255,e[16]=A>>>0&255,e[17]=A>>>8&255,e[18]=A>>>16&255,e[19]=A>>>24&255,e[20]=T>>>0&255,e[21]=T>>>8&255,e[22]=T>>>16&255,e[23]=T>>>24&255,e[24]=O>>>0&255,e[25]=O>>>8&255,e[26]=O>>>16&255,e[27]=O>>>24&255,e[28]=x>>>0&255,e[29]=x>>>8&255,e[30]=x>>>16&255,e[31]=x>>>24&255,e[32]=C>>>0&255,e[33]=C>>>8&255,e[34]=C>>>16&255,e[35]=C>>>24&255,e[36]=N>>>0&255,e[37]=N>>>8&255,e[38]=N>>>16&255,e[39]=N>>>24&255,e[40]=R>>>0&255,e[41]=R>>>8&255,e[42]=R>>>16&255,e[43]=R>>>24&255,e[44]=$>>>0&255,e[45]=$>>>8&255,e[46]=$>>>16&255,e[47]=$>>>24&255,e[48]=P>>>0&255,e[49]=P>>>8&255,e[50]=P>>>16&255,e[51]=P>>>24&255,e[52]=B>>>0&255,e[53]=B>>>8&255,e[54]=B>>>16&255,e[55]=B>>>24&255,e[56]=L>>>0&255,e[57]=L>>>8&255,e[58]=L>>>16&255,e[59]=L>>>24&255,e[60]=U>>>0&255,e[61]=U>>>8&255,e[62]=U>>>16&255,e[63]=U>>>24&255}(e,t,r,n)}function v(e,t,r,n){!function(e,t,r,n){for(var i,s=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,h=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,l=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,u=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,f=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,d=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,p=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,y=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,_=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,g=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,m=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,b=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,w=0;w<20;w+=2)s^=(i=(g^=(i=(d^=(i=(h^=(i=s+g|0)<<7|i>>>25)+s|0)<<9|i>>>23)+h|0)<<13|i>>>19)+d|0)<<18|i>>>14,l^=(i=(o^=(i=(m^=(i=(p^=(i=l+o|0)<<7|i>>>25)+l|0)<<9|i>>>23)+p|0)<<13|i>>>19)+m|0)<<18|i>>>14,y^=(i=(u^=(i=(a^=(i=(v^=(i=y+u|0)<<7|i>>>25)+y|0)<<9|i>>>23)+v|0)<<13|i>>>19)+a|0)<<18|i>>>14,b^=(i=(_^=(i=(f^=(i=(c^=(i=b+_|0)<<7|i>>>25)+b|0)<<9|i>>>23)+c|0)<<13|i>>>19)+f|0)<<18|i>>>14,s^=(i=(c^=(i=(a^=(i=(o^=(i=s+c|0)<<7|i>>>25)+s|0)<<9|i>>>23)+o|0)<<13|i>>>19)+a|0)<<18|i>>>14,l^=(i=(h^=(i=(f^=(i=(u^=(i=l+h|0)<<7|i>>>25)+l|0)<<9|i>>>23)+u|0)<<13|i>>>19)+f|0)<<18|i>>>14,y^=(i=(p^=(i=(d^=(i=(_^=(i=y+p|0)<<7|i>>>25)+y|0)<<9|i>>>23)+_|0)<<13|i>>>19)+d|0)<<18|i>>>14,b^=(i=(v^=(i=(m^=(i=(g^=(i=b+v|0)<<7|i>>>25)+b|0)<<9|i>>>23)+g|0)<<13|i>>>19)+m|0)<<18|i>>>14;e[0]=s>>>0&255,e[1]=s>>>8&255,e[2]=s>>>16&255,e[3]=s>>>24&255,e[4]=l>>>0&255,e[5]=l>>>8&255,e[6]=l>>>16&255,e[7]=l>>>24&255,e[8]=y>>>0&255,e[9]=y>>>8&255,e[10]=y>>>16&255,e[11]=y>>>24&255,e[12]=b>>>0&255,e[13]=b>>>8&255,e[14]=b>>>16&255,e[15]=b>>>24&255,e[16]=u>>>0&255,e[17]=u>>>8&255,e[18]=u>>>16&255,e[19]=u>>>24&255,e[20]=f>>>0&255,e[21]=f>>>8&255,e[22]=f>>>16&255,e[23]=f>>>24&255,e[24]=d>>>0&255,e[25]=d>>>8&255,e[26]=d>>>16&255,e[27]=d>>>24&255,e[28]=p>>>0&255,e[29]=p>>>8&255,e[30]=p>>>16&255,e[31]=p>>>24&255}(e,t,r,n)}var b=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function w(e,t,r,n,i,s,o){var a,c,h=new Uint8Array(16),l=new Uint8Array(64);for(c=0;c<16;c++)h[c]=0;for(c=0;c<8;c++)h[c]=s[c];for(;i>=64;){for(m(l,h,o,b),c=0;c<64;c++)e[t+c]=r[n+c]^l[c];for(a=1,c=8;c<16;c++)a=a+(255&h[c])|0,h[c]=255&a,a>>>=8;i-=64,t+=64,n+=64}if(i>0)for(m(l,h,o,b),c=0;c<i;c++)e[t+c]=r[n+c]^l[c];return 0}function E(e,t,r,n,i){var s,o,a=new Uint8Array(16),c=new Uint8Array(64);for(o=0;o<16;o++)a[o]=0;for(o=0;o<8;o++)a[o]=n[o];for(;r>=64;){for(m(c,a,i,b),o=0;o<64;o++)e[t+o]=c[o];for(s=1,o=8;o<16;o++)s=s+(255&a[o])|0,a[o]=255&s,s>>>=8;r-=64,t+=64}if(r>0)for(m(c,a,i,b),o=0;o<r;o++)e[t+o]=c[o];return 0}function S(e,t,r,n,i){var s=new Uint8Array(32);v(s,n,i,b);for(var o=new Uint8Array(8),a=0;a<8;a++)o[a]=n[a+16];return E(e,t,r,o,s)}function A(e,t,r,n,i,s,o){var a=new Uint8Array(32);v(a,s,o,b);for(var c=new Uint8Array(8),h=0;h<8;h++)c[h]=s[h+16];return w(e,t,r,n,i,c,a)}var T=function(e){var t,r,n,i,s,o,a,c;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,t=255&e[0]|(255&e[1])<<8,this.r[0]=8191&t,r=255&e[2]|(255&e[3])<<8,this.r[1]=8191&(t>>>13|r<<3),n=255&e[4]|(255&e[5])<<8,this.r[2]=7939&(r>>>10|n<<6),i=255&e[6]|(255&e[7])<<8,this.r[3]=8191&(n>>>7|i<<9),s=255&e[8]|(255&e[9])<<8,this.r[4]=255&(i>>>4|s<<12),this.r[5]=s>>>1&8190,o=255&e[10]|(255&e[11])<<8,this.r[6]=8191&(s>>>14|o<<2),a=255&e[12]|(255&e[13])<<8,this.r[7]=8065&(o>>>11|a<<5),c=255&e[14]|(255&e[15])<<8,this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127,this.pad[0]=255&e[16]|(255&e[17])<<8,this.pad[1]=255&e[18]|(255&e[19])<<8,this.pad[2]=255&e[20]|(255&e[21])<<8,this.pad[3]=255&e[22]|(255&e[23])<<8,this.pad[4]=255&e[24]|(255&e[25])<<8,this.pad[5]=255&e[26]|(255&e[27])<<8,this.pad[6]=255&e[28]|(255&e[29])<<8,this.pad[7]=255&e[30]|(255&e[31])<<8};function O(e,t,r,n,i,s){var o=new T(s);return o.update(r,n,i),o.finish(e,t),0}function x(e,t,r,n,i,s){var o=new Uint8Array(16);return O(o,0,r,n,i,s),_(e,t,o,0)}function C(e,t,r,n,i){var s;if(r<32)return-1;for(A(e,0,t,0,r,n,i),O(e,16,e,32,r-32,e),s=0;s<16;s++)e[s]=0;return 0}function N(e,t,r,n,i){var s,o=new Uint8Array(32);if(r<32)return-1;if(S(o,0,32,n,i),0!==x(t,16,t,32,r-32,o))return-1;for(A(e,0,t,0,r,n,i),s=0;s<32;s++)e[s]=0;return 0}function R(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function $(e){var t,r,n=1;for(t=0;t<16;t++)r=e[t]+n+65535,n=Math.floor(r/65536),e[t]=r-65536*n;e[0]+=n-1+37*(n-1)}function P(e,t,r){for(var n,i=~(r-1),s=0;s<16;s++)n=i&(e[s]^t[s]),e[s]^=n,t[s]^=n}function B(e,t){var n,i,s,o=r(),a=r();for(n=0;n<16;n++)a[n]=t[n];for($(a),$(a),$(a),i=0;i<2;i++){for(o[0]=a[0]-65517,n=1;n<15;n++)o[n]=a[n]-65535-(o[n-1]>>16&1),o[n-1]&=65535;o[15]=a[15]-32767-(o[14]>>16&1),s=o[15]>>16&1,o[14]&=65535,P(a,o,1-s)}for(n=0;n<16;n++)e[2*n]=255&a[n],e[2*n+1]=a[n]>>8}function L(e,t){var r=new Uint8Array(32),n=new Uint8Array(32);return B(r,e),B(n,t),g(r,0,n,0)}function U(e){var t=new Uint8Array(32);return B(t,e),1&t[0]}function j(e,t){var r;for(r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function D(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]+r[n]}function M(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]-r[n]}function I(e,t,r){var n,i,s=0,o=0,a=0,c=0,h=0,l=0,u=0,f=0,d=0,p=0,y=0,_=0,g=0,m=0,v=0,b=0,w=0,E=0,k=0,S=0,A=0,T=0,O=0,x=0,C=0,N=0,R=0,$=0,P=0,B=0,L=0,U=r[0],j=r[1],D=r[2],M=r[3],I=r[4],F=r[5],W=r[6],q=r[7],K=r[8],z=r[9],H=r[10],V=r[11],Y=r[12],G=r[13],J=r[14],X=r[15];s+=(n=t[0])*U,o+=n*j,a+=n*D,c+=n*M,h+=n*I,l+=n*F,u+=n*W,f+=n*q,d+=n*K,p+=n*z,y+=n*H,_+=n*V,g+=n*Y,m+=n*G,v+=n*J,b+=n*X,o+=(n=t[1])*U,a+=n*j,c+=n*D,h+=n*M,l+=n*I,u+=n*F,f+=n*W,d+=n*q,p+=n*K,y+=n*z,_+=n*H,g+=n*V,m+=n*Y,v+=n*G,b+=n*J,w+=n*X,a+=(n=t[2])*U,c+=n*j,h+=n*D,l+=n*M,u+=n*I,f+=n*F,d+=n*W,p+=n*q,y+=n*K,_+=n*z,g+=n*H,m+=n*V,v+=n*Y,b+=n*G,w+=n*J,E+=n*X,c+=(n=t[3])*U,h+=n*j,l+=n*D,u+=n*M,f+=n*I,d+=n*F,p+=n*W,y+=n*q,_+=n*K,g+=n*z,m+=n*H,v+=n*V,b+=n*Y,w+=n*G,E+=n*J,k+=n*X,h+=(n=t[4])*U,l+=n*j,u+=n*D,f+=n*M,d+=n*I,p+=n*F,y+=n*W,_+=n*q,g+=n*K,m+=n*z,v+=n*H,b+=n*V,w+=n*Y,E+=n*G,k+=n*J,S+=n*X,l+=(n=t[5])*U,u+=n*j,f+=n*D,d+=n*M,p+=n*I,y+=n*F,_+=n*W,g+=n*q,m+=n*K,v+=n*z,b+=n*H,w+=n*V,E+=n*Y,k+=n*G,S+=n*J,A+=n*X,u+=(n=t[6])*U,f+=n*j,d+=n*D,p+=n*M,y+=n*I,_+=n*F,g+=n*W,m+=n*q,v+=n*K,b+=n*z,w+=n*H,E+=n*V,k+=n*Y,S+=n*G,A+=n*J,T+=n*X,f+=(n=t[7])*U,d+=n*j,p+=n*D,y+=n*M,_+=n*I,g+=n*F,m+=n*W,v+=n*q,b+=n*K,w+=n*z,E+=n*H,k+=n*V,S+=n*Y,A+=n*G,T+=n*J,O+=n*X,d+=(n=t[8])*U,p+=n*j,y+=n*D,_+=n*M,g+=n*I,m+=n*F,v+=n*W,b+=n*q,w+=n*K,E+=n*z,k+=n*H,S+=n*V,A+=n*Y,T+=n*G,O+=n*J,x+=n*X,p+=(n=t[9])*U,y+=n*j,_+=n*D,g+=n*M,m+=n*I,v+=n*F,b+=n*W,w+=n*q,E+=n*K,k+=n*z,S+=n*H,A+=n*V,T+=n*Y,O+=n*G,x+=n*J,C+=n*X,y+=(n=t[10])*U,_+=n*j,g+=n*D,m+=n*M,v+=n*I,b+=n*F,w+=n*W,E+=n*q,k+=n*K,S+=n*z,A+=n*H,T+=n*V,O+=n*Y,x+=n*G,C+=n*J,N+=n*X,_+=(n=t[11])*U,g+=n*j,m+=n*D,v+=n*M,b+=n*I,w+=n*F,E+=n*W,k+=n*q,S+=n*K,A+=n*z,T+=n*H,O+=n*V,x+=n*Y,C+=n*G,N+=n*J,R+=n*X,g+=(n=t[12])*U,m+=n*j,v+=n*D,b+=n*M,w+=n*I,E+=n*F,k+=n*W,S+=n*q,A+=n*K,T+=n*z,O+=n*H,x+=n*V,C+=n*Y,N+=n*G,R+=n*J,$+=n*X,m+=(n=t[13])*U,v+=n*j,b+=n*D,w+=n*M,E+=n*I,k+=n*F,S+=n*W,A+=n*q,T+=n*K,O+=n*z,x+=n*H,C+=n*V,N+=n*Y,R+=n*G,$+=n*J,P+=n*X,v+=(n=t[14])*U,b+=n*j,w+=n*D,E+=n*M,k+=n*I,S+=n*F,A+=n*W,T+=n*q,O+=n*K,x+=n*z,C+=n*H,N+=n*V,R+=n*Y,$+=n*G,P+=n*J,B+=n*X,b+=(n=t[15])*U,o+=38*(E+=n*D),a+=38*(k+=n*M),c+=38*(S+=n*I),h+=38*(A+=n*F),l+=38*(T+=n*W),u+=38*(O+=n*q),f+=38*(x+=n*K),d+=38*(C+=n*z),p+=38*(N+=n*H),y+=38*(R+=n*V),_+=38*($+=n*Y),g+=38*(P+=n*G),m+=38*(B+=n*J),v+=38*(L+=n*X),s=(n=(s+=38*(w+=n*j))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=a+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),_=(n=_+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),s=(n=(s+=i-1+37*(i-1))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=a+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),_=(n=_+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),s+=i-1+37*(i-1),e[0]=s,e[1]=o,e[2]=a,e[3]=c,e[4]=h,e[5]=l,e[6]=u,e[7]=f,e[8]=d,e[9]=p,e[10]=y,e[11]=_,e[12]=g,e[13]=m,e[14]=v,e[15]=b}function F(e,t){I(e,t,t)}function W(e,t){var n,i=r();for(n=0;n<16;n++)i[n]=t[n];for(n=253;n>=0;n--)F(i,i),2!==n&&4!==n&&I(i,i,t);for(n=0;n<16;n++)e[n]=i[n]}function q(e,t){var n,i=r();for(n=0;n<16;n++)i[n]=t[n];for(n=250;n>=0;n--)F(i,i),1!==n&&I(i,i,t);for(n=0;n<16;n++)e[n]=i[n]}function K(e,t,n){var i,s,o=new Uint8Array(32),a=new Float64Array(80),h=r(),l=r(),u=r(),f=r(),d=r(),p=r();for(s=0;s<31;s++)o[s]=t[s];for(o[31]=127&t[31]|64,o[0]&=248,j(a,n),s=0;s<16;s++)l[s]=a[s],f[s]=h[s]=u[s]=0;for(h[0]=f[0]=1,s=254;s>=0;--s)P(h,l,i=o[s>>>3]>>>(7&s)&1),P(u,f,i),D(d,h,u),M(h,h,u),D(u,l,f),M(l,l,f),F(f,d),F(p,h),I(h,u,h),I(u,l,d),D(d,h,u),M(h,h,u),F(l,h),M(u,f,p),I(h,u,c),D(h,h,f),I(u,u,h),I(h,f,p),I(f,l,a),F(l,d),P(h,l,i),P(u,f,i);for(s=0;s<16;s++)a[s+16]=h[s],a[s+32]=u[s],a[s+48]=l[s],a[s+64]=f[s];var y=a.subarray(32),_=a.subarray(16);return W(y,y),I(_,_,y),B(e,_),0}function z(e,t){return K(e,t,s)}function H(e,t){return n(t,32),z(e,t)}function V(e,t,r){var n=new Uint8Array(32);return K(n,r,t),v(e,i,n,b)}T.prototype.blocks=function(e,t,r){for(var n,i,s,o,a,c,h,l,u,f,d,p,y,_,g,m,v,b,w,E=this.fin?0:2048,k=this.h[0],S=this.h[1],A=this.h[2],T=this.h[3],O=this.h[4],x=this.h[5],C=this.h[6],N=this.h[7],R=this.h[8],$=this.h[9],P=this.r[0],B=this.r[1],L=this.r[2],U=this.r[3],j=this.r[4],D=this.r[5],M=this.r[6],I=this.r[7],F=this.r[8],W=this.r[9];r>=16;)f=u=0,f+=(k+=8191&(n=255&e[t+0]|(255&e[t+1])<<8))*P,f+=(S+=8191&(n>>>13|(i=255&e[t+2]|(255&e[t+3])<<8)<<3))*(5*W),f+=(A+=8191&(i>>>10|(s=255&e[t+4]|(255&e[t+5])<<8)<<6))*(5*F),f+=(T+=8191&(s>>>7|(o=255&e[t+6]|(255&e[t+7])<<8)<<9))*(5*I),u=(f+=(O+=8191&(o>>>4|(a=255&e[t+8]|(255&e[t+9])<<8)<<12))*(5*M))>>>13,f&=8191,f+=(x+=a>>>1&8191)*(5*D),f+=(C+=8191&(a>>>14|(c=255&e[t+10]|(255&e[t+11])<<8)<<2))*(5*j),f+=(N+=8191&(c>>>11|(h=255&e[t+12]|(255&e[t+13])<<8)<<5))*(5*U),f+=(R+=8191&(h>>>8|(l=255&e[t+14]|(255&e[t+15])<<8)<<8))*(5*L),d=u+=(f+=($+=l>>>5|E)*(5*B))>>>13,d+=k*B,d+=S*P,d+=A*(5*W),d+=T*(5*F),u=(d+=O*(5*I))>>>13,d&=8191,d+=x*(5*M),d+=C*(5*D),d+=N*(5*j),d+=R*(5*U),u+=(d+=$*(5*L))>>>13,d&=8191,p=u,p+=k*L,p+=S*B,p+=A*P,p+=T*(5*W),u=(p+=O*(5*F))>>>13,p&=8191,p+=x*(5*I),p+=C*(5*M),p+=N*(5*D),p+=R*(5*j),y=u+=(p+=$*(5*U))>>>13,y+=k*U,y+=S*L,y+=A*B,y+=T*P,u=(y+=O*(5*W))>>>13,y&=8191,y+=x*(5*F),y+=C*(5*I),y+=N*(5*M),y+=R*(5*D),_=u+=(y+=$*(5*j))>>>13,_+=k*j,_+=S*U,_+=A*L,_+=T*B,u=(_+=O*P)>>>13,_&=8191,_+=x*(5*W),_+=C*(5*F),_+=N*(5*I),_+=R*(5*M),g=u+=(_+=$*(5*D))>>>13,g+=k*D,g+=S*j,g+=A*U,g+=T*L,u=(g+=O*B)>>>13,g&=8191,g+=x*P,g+=C*(5*W),g+=N*(5*F),g+=R*(5*I),m=u+=(g+=$*(5*M))>>>13,m+=k*M,m+=S*D,m+=A*j,m+=T*U,u=(m+=O*L)>>>13,m&=8191,m+=x*B,m+=C*P,m+=N*(5*W),m+=R*(5*F),v=u+=(m+=$*(5*I))>>>13,v+=k*I,v+=S*M,v+=A*D,v+=T*j,u=(v+=O*U)>>>13,v&=8191,v+=x*L,v+=C*B,v+=N*P,v+=R*(5*W),b=u+=(v+=$*(5*F))>>>13,b+=k*F,b+=S*I,b+=A*M,b+=T*D,u=(b+=O*j)>>>13,b&=8191,b+=x*U,b+=C*L,b+=N*B,b+=R*P,w=u+=(b+=$*(5*W))>>>13,w+=k*W,w+=S*F,w+=A*I,w+=T*M,u=(w+=O*D)>>>13,w&=8191,w+=x*j,w+=C*U,w+=N*L,w+=R*B,k=f=8191&(u=(u=((u+=(w+=$*P)>>>13)<<2)+u|0)+(f&=8191)|0),S=d+=u>>>=13,A=p&=8191,T=y&=8191,O=_&=8191,x=g&=8191,C=m&=8191,N=v&=8191,R=b&=8191,$=w&=8191,t+=16,r-=16;this.h[0]=k,this.h[1]=S,this.h[2]=A,this.h[3]=T,this.h[4]=O,this.h[5]=x,this.h[6]=C,this.h[7]=N,this.h[8]=R,this.h[9]=$},T.prototype.finish=function(e,t){var r,n,i,s,o=new Uint16Array(10);if(this.leftover){for(s=this.leftover,this.buffer[s++]=1;s<16;s++)this.buffer[s]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(r=this.h[1]>>>13,this.h[1]&=8191,s=2;s<10;s++)this.h[s]+=r,r=this.h[s]>>>13,this.h[s]&=8191;for(this.h[0]+=5*r,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r,o[0]=this.h[0]+5,r=o[0]>>>13,o[0]&=8191,s=1;s<10;s++)o[s]=this.h[s]+r,r=o[s]>>>13,o[s]&=8191;for(o[9]-=8192,n=(1^r)-1,s=0;s<10;s++)o[s]&=n;for(n=~n,s=0;s<10;s++)this.h[s]=this.h[s]&n|o[s];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),i=this.h[0]+this.pad[0],this.h[0]=65535&i,s=1;s<8;s++)i=(this.h[s]+this.pad[s]|0)+(i>>>16)|0,this.h[s]=65535&i;e[t+0]=this.h[0]>>>0&255,e[t+1]=this.h[0]>>>8&255,e[t+2]=this.h[1]>>>0&255,e[t+3]=this.h[1]>>>8&255,e[t+4]=this.h[2]>>>0&255,e[t+5]=this.h[2]>>>8&255,e[t+6]=this.h[3]>>>0&255,e[t+7]=this.h[3]>>>8&255,e[t+8]=this.h[4]>>>0&255,e[t+9]=this.h[4]>>>8&255,e[t+10]=this.h[5]>>>0&255,e[t+11]=this.h[5]>>>8&255,e[t+12]=this.h[6]>>>0&255,e[t+13]=this.h[6]>>>8&255,e[t+14]=this.h[7]>>>0&255,e[t+15]=this.h[7]>>>8&255},T.prototype.update=function(e,t,r){var n,i;if(this.leftover){for((i=16-this.leftover)>r&&(i=r),n=0;n<i;n++)this.buffer[this.leftover+n]=e[t+n];if(r-=i,t+=i,this.leftover+=i,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(r>=16&&(i=r-r%16,this.blocks(e,t,i),t+=i,r-=i),r){for(n=0;n<r;n++)this.buffer[this.leftover+n]=e[t+n];this.leftover+=r}};var Y=C,G=N,J=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function X(e,t,r,n){for(var i,s,o,a,c,h,l,u,f,d,p,y,_,g,m,v,b,w,E,k,S,A,T,O,x,C,N=new Int32Array(16),R=new Int32Array(16),$=e[0],P=e[1],B=e[2],L=e[3],U=e[4],j=e[5],D=e[6],M=e[7],I=t[0],F=t[1],W=t[2],q=t[3],K=t[4],z=t[5],H=t[6],V=t[7],Y=0;n>=128;){for(E=0;E<16;E++)k=8*E+Y,N[E]=r[k+0]<<24|r[k+1]<<16|r[k+2]<<8|r[k+3],R[E]=r[k+4]<<24|r[k+5]<<16|r[k+6]<<8|r[k+7];for(E=0;E<80;E++)if(i=$,s=P,o=B,a=L,c=U,h=j,l=D,f=I,d=F,p=W,y=q,_=K,g=z,m=H,T=65535&(A=V),O=A>>>16,x=65535&(S=M),C=S>>>16,T+=65535&(A=(K>>>14|U<<18)^(K>>>18|U<<14)^(U>>>9|K<<23)),O+=A>>>16,x+=65535&(S=(U>>>14|K<<18)^(U>>>18|K<<14)^(K>>>9|U<<23)),C+=S>>>16,T+=65535&(A=K&z^~K&H),O+=A>>>16,x+=65535&(S=U&j^~U&D),C+=S>>>16,S=J[2*E],T+=65535&(A=J[2*E+1]),O+=A>>>16,x+=65535&S,C+=S>>>16,S=N[E%16],O+=(A=R[E%16])>>>16,x+=65535&S,C+=S>>>16,x+=(O+=(T+=65535&A)>>>16)>>>16,T=65535&(A=w=65535&T|O<<16),O=A>>>16,x=65535&(S=b=65535&x|(C+=x>>>16)<<16),C=S>>>16,T+=65535&(A=(I>>>28|$<<4)^($>>>2|I<<30)^($>>>7|I<<25)),O+=A>>>16,x+=65535&(S=($>>>28|I<<4)^(I>>>2|$<<30)^(I>>>7|$<<25)),C+=S>>>16,O+=(A=I&F^I&W^F&W)>>>16,x+=65535&(S=$&P^$&B^P&B),C+=S>>>16,u=65535&(x+=(O+=(T+=65535&A)>>>16)>>>16)|(C+=x>>>16)<<16,v=65535&T|O<<16,T=65535&(A=y),O=A>>>16,x=65535&(S=a),C=S>>>16,O+=(A=w)>>>16,x+=65535&(S=b),C+=S>>>16,P=i,B=s,L=o,U=a=65535&(x+=(O+=(T+=65535&A)>>>16)>>>16)|(C+=x>>>16)<<16,j=c,D=h,M=l,$=u,F=f,W=d,q=p,K=y=65535&T|O<<16,z=_,H=g,V=m,I=v,E%16==15)for(k=0;k<16;k++)S=N[k],T=65535&(A=R[k]),O=A>>>16,x=65535&S,C=S>>>16,S=N[(k+9)%16],T+=65535&(A=R[(k+9)%16]),O+=A>>>16,x+=65535&S,C+=S>>>16,b=N[(k+1)%16],T+=65535&(A=((w=R[(k+1)%16])>>>1|b<<31)^(w>>>8|b<<24)^(w>>>7|b<<25)),O+=A>>>16,x+=65535&(S=(b>>>1|w<<31)^(b>>>8|w<<24)^b>>>7),C+=S>>>16,b=N[(k+14)%16],O+=(A=((w=R[(k+14)%16])>>>19|b<<13)^(b>>>29|w<<3)^(w>>>6|b<<26))>>>16,x+=65535&(S=(b>>>19|w<<13)^(w>>>29|b<<3)^b>>>6),C+=S>>>16,C+=(x+=(O+=(T+=65535&A)>>>16)>>>16)>>>16,N[k]=65535&x|C<<16,R[k]=65535&T|O<<16;T=65535&(A=I),O=A>>>16,x=65535&(S=$),C=S>>>16,S=e[0],O+=(A=t[0])>>>16,x+=65535&S,C+=S>>>16,C+=(x+=(O+=(T+=65535&A)>>>16)>>>16)>>>16,e[0]=$=65535&x|C<<16,t[0]=I=65535&T|O<<16,T=65535&(A=F),O=A>>>16,x=65535&(S=P),C=S>>>16,S=e[1],O+=(A=t[1])>>>16,x+=65535&S,C+=S>>>16,C+=(x+=(O+=(T+=65535&A)>>>16)>>>16)>>>16,e[1]=P=65535&x|C<<16,t[1]=F=65535&T|O<<16,T=65535&(A=W),O=A>>>16,x=65535&(S=B),C=S>>>16,S=e[2],O+=(A=t[2])>>>16,x+=65535&S,C+=S>>>16,C+=(x+=(O+=(T+=65535&A)>>>16)>>>16)>>>16,e[2]=B=65535&x|C<<16,t[2]=W=65535&T|O<<16,T=65535&(A=q),O=A>>>16,x=65535&(S=L),C=S>>>16,S=e[3],O+=(A=t[3])>>>16,x+=65535&S,C+=S>>>16,C+=(x+=(O+=(T+=65535&A)>>>16)>>>16)>>>16,e[3]=L=65535&x|C<<16,t[3]=q=65535&T|O<<16,T=65535&(A=K),O=A>>>16,x=65535&(S=U),C=S>>>16,S=e[4],O+=(A=t[4])>>>16,x+=65535&S,C+=S>>>16,C+=(x+=(O+=(T+=65535&A)>>>16)>>>16)>>>16,e[4]=U=65535&x|C<<16,t[4]=K=65535&T|O<<16,T=65535&(A=z),O=A>>>16,x=65535&(S=j),C=S>>>16,S=e[5],O+=(A=t[5])>>>16,x+=65535&S,C+=S>>>16,C+=(x+=(O+=(T+=65535&A)>>>16)>>>16)>>>16,e[5]=j=65535&x|C<<16,t[5]=z=65535&T|O<<16,T=65535&(A=H),O=A>>>16,x=65535&(S=D),C=S>>>16,S=e[6],O+=(A=t[6])>>>16,x+=65535&S,C+=S>>>16,C+=(x+=(O+=(T+=65535&A)>>>16)>>>16)>>>16,e[6]=D=65535&x|C<<16,t[6]=H=65535&T|O<<16,T=65535&(A=V),O=A>>>16,x=65535&(S=M),C=S>>>16,S=e[7],O+=(A=t[7])>>>16,x+=65535&S,C+=S>>>16,C+=(x+=(O+=(T+=65535&A)>>>16)>>>16)>>>16,e[7]=M=65535&x|C<<16,t[7]=V=65535&T|O<<16,Y+=128,n-=128}return n}function Q(e,t,r){var n,i=new Int32Array(8),s=new Int32Array(8),o=new Uint8Array(256),a=r;for(i[0]=1779033703,i[1]=3144134277,i[2]=1013904242,i[3]=2773480762,i[4]=1359893119,i[5]=2600822924,i[6]=528734635,i[7]=1541459225,s[0]=4089235720,s[1]=2227873595,s[2]=4271175723,s[3]=1595750129,s[4]=2917565137,s[5]=725511199,s[6]=4215389547,s[7]=327033209,X(i,s,t,r),r%=128,n=0;n<r;n++)o[n]=t[a-r+n];for(o[r]=128,o[(r=256-128*(r<112?1:0))-9]=0,p(o,r-8,a/536870912|0,a<<3),X(i,s,o,r),n=0;n<8;n++)p(e,8*n,i[n],s[n]);return 0}function Z(e,t){var n=r(),i=r(),s=r(),o=r(),a=r(),c=r(),h=r(),u=r(),f=r();M(n,e[1],e[0]),M(f,t[1],t[0]),I(n,n,f),D(i,e[0],e[1]),D(f,t[0],t[1]),I(i,i,f),I(s,e[3],t[3]),I(s,s,l),I(o,e[2],t[2]),D(o,o,o),M(a,i,n),M(c,o,s),D(h,o,s),D(u,i,n),I(e[0],a,c),I(e[1],u,h),I(e[2],h,c),I(e[3],a,u)}function ee(e,t,r){var n;for(n=0;n<4;n++)P(e[n],t[n],r)}function te(e,t){var n=r(),i=r(),s=r();W(s,t[2]),I(n,t[0],s),I(i,t[1],s),B(e,i),e[31]^=U(n)<<7}function re(e,t,r){var n,i;for(R(e[0],o),R(e[1],a),R(e[2],a),R(e[3],o),i=255;i>=0;--i)ee(e,t,n=r[i/8|0]>>(7&i)&1),Z(t,e),Z(e,e),ee(e,t,n)}function ne(e,t){var n=[r(),r(),r(),r()];R(n[0],u),R(n[1],f),R(n[2],a),I(n[3],u,f),re(e,n,t)}function ie(e,t,i){var s,o=new Uint8Array(64),a=[r(),r(),r(),r()];for(i||n(t,32),Q(o,t,32),o[0]&=248,o[31]&=127,o[31]|=64,ne(a,o),te(e,a),s=0;s<32;s++)t[s+32]=e[s];return 0}var se=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function oe(e,t){var r,n,i,s;for(n=63;n>=32;--n){for(r=0,i=n-32,s=n-12;i<s;++i)t[i]+=r-16*t[n]*se[i-(n-32)],r=Math.floor((t[i]+128)/256),t[i]-=256*r;t[i]+=r,t[n]=0}for(r=0,i=0;i<32;i++)t[i]+=r-(t[31]>>4)*se[i],r=t[i]>>8,t[i]&=255;for(i=0;i<32;i++)t[i]-=r*se[i];for(n=0;n<32;n++)t[n+1]+=t[n]>>8,e[n]=255&t[n]}function ae(e){var t,r=new Float64Array(64);for(t=0;t<64;t++)r[t]=e[t];for(t=0;t<64;t++)e[t]=0;oe(e,r)}function ce(e,t,n,i){var s,o,a=new Uint8Array(64),c=new Uint8Array(64),h=new Uint8Array(64),l=new Float64Array(64),u=[r(),r(),r(),r()];Q(a,i,32),a[0]&=248,a[31]&=127,a[31]|=64;var f=n+64;for(s=0;s<n;s++)e[64+s]=t[s];for(s=0;s<32;s++)e[32+s]=a[32+s];for(Q(h,e.subarray(32),n+32),ae(h),ne(u,h),te(e,u),s=32;s<64;s++)e[s]=i[s];for(Q(c,e,n+64),ae(c),s=0;s<64;s++)l[s]=0;for(s=0;s<32;s++)l[s]=h[s];for(s=0;s<32;s++)for(o=0;o<32;o++)l[s+o]+=c[s]*a[o];return oe(e.subarray(32),l),f}function he(e,t,n,i){var s,c=new Uint8Array(32),l=new Uint8Array(64),u=[r(),r(),r(),r()],f=[r(),r(),r(),r()];if(n<64)return-1;if(function(e,t){var n=r(),i=r(),s=r(),c=r(),l=r(),u=r(),f=r();return R(e[2],a),j(e[1],t),F(s,e[1]),I(c,s,h),M(s,s,e[2]),D(c,e[2],c),F(l,c),F(u,l),I(f,u,l),I(n,f,s),I(n,n,c),q(n,n),I(n,n,s),I(n,n,c),I(n,n,c),I(e[0],n,c),F(i,e[0]),I(i,i,c),L(i,s)&&I(e[0],e[0],d),F(i,e[0]),I(i,i,c),L(i,s)?-1:(U(e[0])===t[31]>>7&&M(e[0],o,e[0]),I(e[3],e[0],e[1]),0)}(f,i))return-1;for(s=0;s<n;s++)e[s]=t[s];for(s=0;s<32;s++)e[s+32]=i[s];if(Q(l,e,n),ae(l),re(u,f,l),ne(f,t.subarray(32)),Z(u,f),te(c,u),n-=64,g(t,0,c,0)){for(s=0;s<n;s++)e[s]=0;return-1}for(s=0;s<n;s++)e[s]=t[s+64];return n}var le,ue=16,fe=64,de=32,pe=64;function ye(e,t){if(32!==e.length)throw new Error("bad key size");if(24!==t.length)throw new Error("bad nonce size")}function _e(){for(var e=0;e<arguments.length;e++)if(!(arguments[e]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function ge(e){for(var t=0;t<e.length;t++)e[t]=0}e.lowlevel={crypto_core_hsalsa20:v,crypto_stream_xor:A,crypto_stream:S,crypto_stream_salsa20_xor:w,crypto_stream_salsa20:E,crypto_onetimeauth:O,crypto_onetimeauth_verify:x,crypto_verify_16:_,crypto_verify_32:g,crypto_secretbox:C,crypto_secretbox_open:N,crypto_scalarmult:K,crypto_scalarmult_base:z,crypto_box_beforenm:V,crypto_box_afternm:Y,crypto_box:function(e,t,r,n,i,s){var o=new Uint8Array(32);return V(o,i,s),Y(e,t,r,n,o)},crypto_box_open:function(e,t,r,n,i,s){var o=new Uint8Array(32);return V(o,i,s),G(e,t,r,n,o)},crypto_box_keypair:H,crypto_hash:Q,crypto_sign:ce,crypto_sign_keypair:ie,crypto_sign_open:he,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:ue,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:fe,crypto_sign_PUBLICKEYBYTES:de,crypto_sign_SECRETKEYBYTES:pe,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:r,D:h,L:se,pack25519:B,unpack25519:j,M:I,A:D,S:F,Z:M,pow2523:q,add:Z,set25519:R,modL:oe,scalarmult:re,scalarbase:ne},e.randomBytes=function(e){var t=new Uint8Array(e);return n(t,e),t},e.secretbox=function(e,t,r){_e(e,t,r),ye(r,t);for(var n=new Uint8Array(32+e.length),i=new Uint8Array(n.length),s=0;s<e.length;s++)n[s+32]=e[s];return C(i,n,n.length,t,r),i.subarray(ue)},e.secretbox.open=function(e,t,r){_e(e,t,r),ye(r,t);for(var n=new Uint8Array(ue+e.length),i=new Uint8Array(n.length),s=0;s<e.length;s++)n[s+ue]=e[s];return n.length<32||0!==N(i,n,n.length,t,r)?null:i.subarray(32)},e.secretbox.keyLength=32,e.secretbox.nonceLength=24,e.secretbox.overheadLength=ue,e.scalarMult=function(e,t){if(_e(e,t),32!==e.length)throw new Error("bad n size");if(32!==t.length)throw new Error("bad p size");var r=new Uint8Array(32);return K(r,e,t),r},e.scalarMult.base=function(e){if(_e(e),32!==e.length)throw new Error("bad n size");var t=new Uint8Array(32);return z(t,e),t},e.scalarMult.scalarLength=32,e.scalarMult.groupElementLength=32,e.box=function(t,r,n,i){var s=e.box.before(n,i);return e.secretbox(t,r,s)},e.box.before=function(e,t){_e(e,t),function(e,t){if(32!==e.length)throw new Error("bad public key size");if(32!==t.length)throw new Error("bad secret key size")}(e,t);var r=new Uint8Array(32);return V(r,e,t),r},e.box.after=e.secretbox,e.box.open=function(t,r,n,i){var s=e.box.before(n,i);return e.secretbox.open(t,r,s)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(32);return H(e,t),{publicKey:e,secretKey:t}},e.box.keyPair.fromSecretKey=function(e){if(_e(e),32!==e.length)throw new Error("bad secret key size");var t=new Uint8Array(32);return z(t,e),{publicKey:t,secretKey:new Uint8Array(e)}},e.box.publicKeyLength=32,e.box.secretKeyLength=32,e.box.sharedKeyLength=32,e.box.nonceLength=24,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(e,t){if(_e(e,t),t.length!==pe)throw new Error("bad secret key size");var r=new Uint8Array(fe+e.length);return ce(r,e,e.length,t),r},e.sign.open=function(e,t){if(_e(e,t),t.length!==de)throw new Error("bad public key size");var r=new Uint8Array(e.length),n=he(r,e,e.length,t);if(n<0)return null;for(var i=new Uint8Array(n),s=0;s<i.length;s++)i[s]=r[s];return i},e.sign.detached=function(t,r){for(var n=e.sign(t,r),i=new Uint8Array(fe),s=0;s<i.length;s++)i[s]=n[s];return i},e.sign.detached.verify=function(e,t,r){if(_e(e,t,r),t.length!==fe)throw new Error("bad signature size");if(r.length!==de)throw new Error("bad public key size");var n,i=new Uint8Array(fe+e.length),s=new Uint8Array(fe+e.length);for(n=0;n<fe;n++)i[n]=t[n];for(n=0;n<e.length;n++)i[n+fe]=e[n];return he(s,i,i.length,r)>=0},e.sign.keyPair=function(){var e=new Uint8Array(de),t=new Uint8Array(pe);return ie(e,t),{publicKey:e,secretKey:t}},e.sign.keyPair.fromSecretKey=function(e){if(_e(e),e.length!==pe)throw new Error("bad secret key size");for(var t=new Uint8Array(de),r=0;r<t.length;r++)t[r]=e[32+r];return{publicKey:t,secretKey:new Uint8Array(e)}},e.sign.keyPair.fromSeed=function(e){if(_e(e),32!==e.length)throw new Error("bad seed size");for(var t=new Uint8Array(de),r=new Uint8Array(pe),n=0;n<32;n++)r[n]=e[n];return ie(t,r,!0),{publicKey:t,secretKey:r}},e.sign.publicKeyLength=de,e.sign.secretKeyLength=pe,e.sign.seedLength=32,e.sign.signatureLength=fe,e.hash=function(e){_e(e);var t=new Uint8Array(64);return Q(t,e,e.length),t},e.hash.hashLength=64,e.verify=function(e,t){return _e(e,t),0!==e.length&&0!==t.length&&e.length===t.length&&0===y(e,0,t,0,e.length)},e.setPRNG=function(e){n=e},(le="undefined"!=typeof self?self.crypto||self.msCrypto:null)&&le.getRandomValues?e.setPRNG((function(e,t){var r,n=new Uint8Array(t);for(r=0;r<t;r+=65536)le.getRandomValues(n.subarray(r,r+Math.min(t-r,65536)));for(r=0;r<t;r++)e[r]=n[r];ge(n)})):void 0!==k&&(le=t)&&le.randomBytes&&e.setPRNG((function(e,t){var r,n=le.randomBytes(t);for(r=0;r<t;r++)e[r]=n[r];ge(n)}))}(V.exports?V.exports:self.nacl=self.nacl||{});var Y=w(V.exports);const{encrypt:G,decrypt:J}=K,{box:X,randomBytes:Q}=Y,Z=e=>e?.simpleError?e:((e,t)=>({simpleError:{error:e,message:t}}))("unexpected_error",`${e}`),ee=e=>e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof Date),te=e=>"number"==typeof e&&!`${e}`.includes("."),re=(e,t="",r=[],n=".")=>{let i=[];const s=Array.isArray(t);return Object.entries(e).forEach((([e,o])=>{ee(o)&&!r.includes(e)?i=[...i,...re(o,s?[...t,e]:`${t}${e}${n}`,r,n)]:i.push(s?[[...t,e],o]:[`${t}${e}`,o])})),i},ne=e=>{const t=[],r=[];if(Array.isArray(e))e.forEach((e=>{ee(e)?re(e).map((([e,n])=>{t.push(e),r.push(n)})):t.push(Array.isArray(e)?JSON.stringify(e):`${e}`)}));else{if(!ee(e))return`${e}`;re(e).map((([e,n])=>{t.push(e),r.push(n)}))}return[...t.sort(),...r.map((e=>`${Array.isArray(e)?JSON.stringify(e):e}`)).sort()].join(",")},ie=e=>e&&"object"==typeof e?Array.isArray(e)?[...e]:{...e}:e,se=(e,t)=>g.listenTo(t,(t=>{"boolean"==typeof t&&e?.(t)}),!0),oe=e=>new Promise((async t=>{try{t(await e())}catch(e){t()}}));const ae=(t,r,n)=>{const i=X.keyPair(),s=Q(X.nonceLength);return[`${e.Buffer.from(i.publicKey).toString("base64")}.${e.Buffer.from(s).toString("base64")}.${e.Buffer.from(X(e.Buffer.from(JSON.stringify([t,r]),"utf8"),s,e.Buffer.from(n,"base64"),i.secretKey)).toString("base64")}`,[i.secretKey,i.publicKey]]},ce=(t,r,n)=>{const[i,s]=t.split("."),o=X.open(e.Buffer.from(s,"base64"),e.Buffer.from(i,"base64"),e.Buffer.from(r,"base64"),n);if(!o)throw"Decrypting e2e message failed";return JSON.parse(e.Buffer.from(o).toString("utf8"))[0]},he=t=>e.Buffer.from(t,"utf8").toString("base64"),le=he("MOSQUITO_TRANSPORT_FREEZER"),ue=he("MOSQUITO_TRANSPORT_CACHE_PASSWORD"),fe="DEFAULT_DB",de="mongodb://127.0.0.1:27017",pe={LOCAL_STORAGE:"local-storage"},ye={STICKY:"sticky",STICKY_NO_AWAIT:"sticky-no-await",STICKY_RELOAD:"sticky-reload",DEFAULT:"default",CACHE_NO_AWAIT:"cache-no-await",NO_CACHE_NO_AWAIT:"no-cache-no-await"},_e={DEFAULT:"default",NO_CACHE:"no-cache",NO_AWAIT:"no-await",NO_AWAIT_NO_CACHE:"no-await-no-cache",AWAIT_NO_CACHE:"await-no-cache",CACHE_NO_AWAIT:"cache-no-await"},ge={$SET:"$set",$PUSH:"$push",$PULL:"$pull",$UNSET:"$unset",$INC:"$inc",$MAX:"$max",$MIN:"$min",$MUL:"$mul",$RENAME:"$rename"},me=Object.values(ge),ve={$IN:"$in",$ALL:"$all",$NIN:"$nin",$GT:"$gt",$GTE:"$gte",$LT:"$lt",$LTE:"$lte",$TEXT:"$text",$NEAR:"$near",$TYPE:"$type",$SIZE:"$size"},be=Object.values(ve),we=()=>/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,Ee={PendingIte:0,AnyProcessIte:0,IS_CONNECTED:{},IS_TOKEN_READY:{},InitializedProject:{},ReleaseCacheData:void 0,AuthJWTToken:{},cacheStorageReducer:void 0,TokenRefreshTimer:{},LastTokenRefreshRef:{},StorageProcessID:0,InitiatedForcedToken:{},PendingFetchCollective:{pendingProcess:{},pendingResolution:{}},PendingDbReadCollective:{pendingProcess:{},pendingResolution:{}}},ke={DatabaseStore:{},DatabaseRecords:{},DatabaseCountResult:{},AuthStore:{},PendingWrites:{},FetchedStore:{}},Se={...ke},Ae=()=>{try{window}catch(e){return}const{cachePassword:e=ue,cacheProtocol:t=pe.LOCAL_STORAGE}=Ee.ReleaseCacheData;clearTimeout(Ee.cacheStorageReducer),Ee.cacheStorageReducer=setTimeout((()=>{const r=((e,t,r)=>G(e,`${t||""}${r||""}`).toString())(JSON.stringify({...ke}),e,e);t===pe.LOCAL_STORAGE&&window.localStorage.setItem(le,r)}),500)},Te=async e=>{try{window}catch(e){return}const{cachePassword:t=ue,cacheProtocol:r=pe.LOCAL_STORAGE}=e;let n;r===pe.LOCAL_STORAGE&&(n=window.localStorage.getItem(le));const i=JSON.parse(((e,t,r)=>J(e,`${t||""}${r||""}`).toString(H))(n||"",t,t)||"{}");Object.entries(i).forEach((([e,t])=>{ke[e]=t})),Object.entries(ke.AuthStore).forEach((([e,t])=>{Ee.AuthJWTToken[e]=t?.token})),Ee.IsStoreReady=!0,_.dispatch("_","ready")},Oe=()=>new Promise((e=>{if(Ee.IsStoreReady)return void e();const t=_.listenTo("_",(r=>{"ready"===r&&(e(),t())}),!0)})),xe=e=>new Promise((t=>{if(Ee.IS_CONNECTED[e])return void t();const r=g.listenTo(e,(e=>{e&&(t(),r())}),!0)})),Ce=e=>new Promise((t=>{if("boolean"==typeof Ee.IS_CONNECTED[e])return void t(Ee.IS_CONNECTED[e]);const r=g.listenTo(e,(e=>{"boolean"==typeof e&&(t(e),r())}),!0)})),Ne=({body:e,accessKey:t,authToken:r,method:n,uglify:i,serverE2E_PublicKey:s})=>{i||(e=JSON.stringify({...e}));const[o,a]=i?ae(e,r,s):[void 0,[]];return[{body:i?o:e,cache:"no-cache",headers:{"Content-type":i?"text/plain":"application/json",Authorization:t,...r&&!i?{"Mosquito-Token":r}:{}},method:n||"POST"},a]},Re=(e,t)=>({simpleError:{error:e,message:t}}),$e=Object.create(null);$e.open="0",$e.close="1",$e.ping="2",$e.pong="3",$e.message="4",$e.upgrade="5",$e.noop="6";const Pe=Object.create(null);Object.keys($e).forEach((e=>{Pe[$e[e]]=e}));const Be={type:"error",data:"parser error"},Le=({type:e,data:t},r,n)=>{if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){const e=Ue(t);return n(je(e,r))}return n($e[e]+(t||""))},Ue=e=>Buffer.isBuffer(e)?e:e instanceof ArrayBuffer?Buffer.from(e):Buffer.from(e.buffer,e.byteOffset,e.byteLength),je=(e,t)=>t?e:"b"+e.toString("base64"),De=(e,t)=>{if("string"!=typeof e)return{type:"message",data:Me(e,t)};const r=e.charAt(0);if("b"===r){const r=Buffer.from(e.substring(1),"base64");return{type:"message",data:Me(r,t)}}return Pe[r]?e.length>1?{type:Pe[r],data:e.substring(1)}:{type:Pe[r]}:Be},Me=(e,t)=>{const r=Buffer.isBuffer(e);return"arraybuffer"===t&&r?Ie(e):e},Ie=e=>{const t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e[t];return t},Fe=String.fromCharCode(30);function We(e){if(e)return function(e){for(var t in We.prototype)e[t]=We.prototype[t];return e}(e)}We.prototype.on=We.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},We.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},We.prototype.off=We.prototype.removeListener=We.prototype.removeAllListeners=We.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},We.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},We.prototype.emitReserved=We.prototype.emit,We.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},We.prototype.hasListeners=function(e){return!!this.listeners(e).length};const qe=global;function Ke(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}const ze=qe.setTimeout,He=qe.clearTimeout;function Ve(e,t){t.useNativeTimers?(e.setTimeoutFn=ze.bind(qe),e.clearTimeoutFn=He.bind(qe)):(e.setTimeoutFn=qe.setTimeout.bind(qe),e.clearTimeoutFn=qe.clearTimeout.bind(qe))}class Ye extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class Ge extends We{constructor(e){super(),this.writable=!1,Ve(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new Ye(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=De(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const Je="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Xe=64,Qe={};let Ze,et=0,tt=0;function rt(e){let t="";do{t=Je[e%Xe]+t,e=Math.floor(e/Xe)}while(e>0);return t}function nt(){const e=rt(+new Date);return e!==Ze?(et=0,Ze=e):e+"."+rt(et++)}for(;tt<Xe;tt++)Qe[Je[tt]]=tt;function it(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}
/**
 * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
 *
 * This can be used with JS designed for browsers to improve reuse of code and
 * allow the use of existing libraries.
 *
 * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
 *
 * @author Dan DeFelippi <dan@driverdan.com>
 * @contributor David Ellis <d.f.ellis@ieee.org>
 * @license MIT
 */
var st=r,ot=n,at=i.spawn,ct=ht;function ht(e){e=e||{};var t,r,n=this,i=s,a=o,c={},h=!1,l={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},u=Object.assign({},l),f=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],d=["TRACE","TRACK","CONNECT"],p=!1,y=!1,_=!1,g={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null;this.open=function(e,t,r,n,i){if(this.abort(),y=!1,_=!1,!function(e){return e&&-1===d.indexOf(e)}(e))throw new Error("SecurityError: Request method not allowed");c={method:e,url:t.toString(),async:"boolean"!=typeof r||r,user:n||null,password:i||null},m(this.OPENED)},this.setDisableHeaderCheck=function(e){h=e},this.setRequestHeader=function(e,t){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!function(e){return h||e&&-1===f.indexOf(e.toLowerCase())}(e))return console.warn('Refused to set unsafe header "'+e+'"'),!1;if(p)throw new Error("INVALID_STATE_ERR: send flag is true");return u[e]=t,!0},this.getResponseHeader=function(e){return"string"==typeof e&&this.readyState>this.OPENED&&r.headers[e.toLowerCase()]&&!y?r.headers[e.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||y)return"";var e="";for(var t in r.headers)"set-cookie"!==t&&"set-cookie2"!==t&&(e+=t+": "+r.headers[t]+"\r\n");return e.substr(0,e.length-2)},this.getRequestHeader=function(e){return"string"==typeof e&&u[e]?u[e]:""},this.send=function(s){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(p)throw new Error("INVALID_STATE_ERR: send has already been called");var o,h=!1,l=!1,f=ot.parse(c.url);switch(f.protocol){case"https:":h=!0;case"http:":o=f.hostname;break;case"file:":l=!0;break;case void 0:case"":o="localhost";break;default:throw new Error("Protocol not supported.")}if(l){if("GET"!==c.method)throw new Error("XMLHttpRequest: Only GET method is supported");if(c.async)st.readFile(unescape(f.pathname),"utf8",(function(e,t){e?n.handleError(e,e.errno||-1):(n.status=200,n.responseText=t,m(n.DONE))}));else try{this.responseText=st.readFileSync(unescape(f.pathname),"utf8"),this.status=200,m(n.DONE)}catch(e){this.handleError(e,e.errno||-1)}}else{var d=f.port||(h?443:80),_=f.pathname+(f.search?f.search:"");if(u.Host=o,h&&443===d||80===d||(u.Host+=":"+f.port),c.user){void 0===c.password&&(c.password="");var g=new Buffer(c.user+":"+c.password);u.Authorization="Basic "+g.toString("base64")}"GET"===c.method||"HEAD"===c.method?s=null:s?(u["Content-Length"]=Buffer.isBuffer(s)?s.length:Buffer.byteLength(s),u["Content-Type"]||(u["Content-Type"]="text/plain;charset=UTF-8")):"POST"===c.method&&(u["Content-Length"]=0);var v=e.agent||!1,b={host:o,port:d,path:_,method:c.method,headers:u,agent:v};if(h&&(b.pfx=e.pfx,b.key=e.key,b.passphrase=e.passphrase,b.cert=e.cert,b.ca=e.ca,b.ciphers=e.ciphers,b.rejectUnauthorized=!1!==e.rejectUnauthorized),y=!1,c.async){var w=h?a.request:i.request;p=!0,n.dispatchEvent("readystatechange");var E=function(i){if(302===(r=i).statusCode||303===r.statusCode||307===r.statusCode){c.url=r.headers.location;var s=ot.parse(c.url);o=s.hostname;var a={hostname:s.hostname,port:s.port,path:s.path,method:303===r.statusCode?"GET":c.method,headers:u};return h&&(a.pfx=e.pfx,a.key=e.key,a.passphrase=e.passphrase,a.cert=e.cert,a.ca=e.ca,a.ciphers=e.ciphers,a.rejectUnauthorized=!1!==e.rejectUnauthorized),void(t=w(a,E).on("error",k)).end()}r&&r.setEncoding&&r.setEncoding("utf8"),m(n.HEADERS_RECEIVED),n.status=r.statusCode,r.on("data",(function(e){e&&(n.responseText+=e),p&&m(n.LOADING)})),r.on("end",(function(){p&&(p=!1,m(n.DONE))})),r.on("error",(function(e){n.handleError(e)}))},k=function(e){n.handleError(e)};t=w(b,E).on("error",k),e.autoUnref&&t.on("socket",(e=>{e.unref()})),s&&t.write(s),t.end(),n.dispatchEvent("loadstart")}else{var S=".node-xmlhttprequest-content-"+process.pid,A=".node-xmlhttprequest-sync-"+process.pid;st.writeFileSync(A,"","utf8");for(var T="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(h?"s":"")+".request;var options = "+JSON.stringify(b)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+S+"', 'NODE-XMLHTTPREQUEST-STATUS:' + response.statusCode + ',' + responseText, 'utf8');fs.unlinkSync('"+A+"');});response.on('error', function(error) {fs.writeFileSync('"+S+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+A+"');});}).on('error', function(error) {fs.writeFileSync('"+S+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+A+"');});"+(s?"req.write('"+JSON.stringify(s).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",O=at(process.argv[0],["-e",T]);st.existsSync(A););if(n.responseText=st.readFileSync(S,"utf8"),O.stdin.end(),st.unlinkSync(S),n.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var x=n.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,"");n.handleError(x,503)}else n.status=n.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1"),n.responseText=n.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"),m(n.DONE)}}},this.handleError=function(e,t){this.status=t||0,this.statusText=e,this.responseText=e.stack,y=!0,m(this.DONE)},this.abort=function(){t&&(t.abort(),t=null),u=Object.assign({},l),this.responseText="",this.responseXML="",y=_=!0,this.readyState===this.UNSENT||this.readyState===this.OPENED&&!p||this.readyState===this.DONE||(p=!1,m(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(e,t){e in g||(g[e]=[]),g[e].push(t)},this.removeEventListener=function(e,t){e in g&&(g[e]=g[e].filter((function(e){return e!==t})))},this.dispatchEvent=function(e){if("function"==typeof n["on"+e]&&(this.readyState===this.DONE?setImmediate((function(){n["on"+e]()})):n["on"+e]()),e in g)for(let t=0,r=g[e].length;t<r;t++)this.readyState===this.DONE?setImmediate((function(){g[e][t].call(n)})):g[e][t].call(n)};var m=function(e){if(!(n.readyState===e||n.readyState===n.UNSENT&&_)&&(n.readyState=e,(c.async||n.readyState<n.OPENED||n.readyState===n.DONE)&&n.dispatchEvent("readystatechange"),n.readyState===n.DONE)){let e;e=_?"abort":y?"error":"load",n.dispatchEvent(e),n.dispatchEvent("loadend")}}}ht.XMLHttpRequest=ht;var lt=w(ct);const ut=lt||f({__proto__:null,default:lt},[ct]);function ft(){}const dt=null!=new ut({xdomain:!1}).responseType;class pt extends We{constructor(e,t){super(),Ve(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=Ke(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new ut(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=pt.requestsCount++,pt.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=ft,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete pt.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(pt.requestsCount=0,pt.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",yt);else if("function"==typeof addEventListener){addEventListener("onpagehide"in qe?"pagehide":"unload",yt,!1)}function yt(){for(let e in pt.requests)pt.requests.hasOwnProperty(e)&&pt.requests[e].abort()}var _t={exports:{}},gt={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}};const{EMPTY_BUFFER:mt}=gt;function vt(e,t,r,n,i){for(let s=0;s<i;s++)r[n+s]=e[s]^t[3&s]}function bt(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}if(_t.exports={concat:function(e,t){if(0===e.length)return mt;if(1===e.length)return e[0];const r=Buffer.allocUnsafe(t);let n=0;for(let t=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return n<t?r.slice(0,n):r},mask:vt,toArrayBuffer:function(e){return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)},toBuffer:function e(t){if(e.readOnly=!0,Buffer.isBuffer(t))return t;let r;return t instanceof ArrayBuffer?r=Buffer.from(t):ArrayBuffer.isView(t)?r=Buffer.from(t.buffer,t.byteOffset,t.byteLength):(r=Buffer.from(t),e.readOnly=!1),r},unmask:bt},!process.env.WS_NO_BUFFER_UTIL)try{const e=require("bufferutil");_t.exports.mask=function(t,r,n,i,s){s<48?vt(t,r,n,i,s):e.mask(t,r,n,i,s)},_t.exports.unmask=function(t,r){t.length<32?bt(t,r):e.unmask(t,r)}}catch(e){}var wt=_t.exports;const Et=Symbol("kDone"),kt=Symbol("kRun");const St=c,At=wt,Tt=class{constructor(e){this[Et]=()=>{this.pending--,this[kt]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[kt]()}[kt](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[Et])}}},{kStatusCode:Ot}=gt,xt=Buffer.from([0,0,255,255]),Ct=Symbol("permessage-deflate"),Nt=Symbol("total-length"),Rt=Symbol("callback"),$t=Symbol("buffers"),Pt=Symbol("error");let Bt;var Lt=class{constructor(e,t,r){if(this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!Bt){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;Bt=new Tt(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[Rt];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,r=e.find((e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:!0!==r.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach((e=>{Object.keys(e).forEach((t=>{let r=e[t];if(r.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==r)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}e[t]=r}))})),e}decompress(e,t,r){Bt.add((n=>{this._decompress(e,t,((e,t)=>{n(),r(e,t)}))}))}compress(e,t,r){Bt.add((n=>{this._compress(e,t,((e,t)=>{n(),r(e,t)}))}))}_decompress(e,t,r){const n=this._isServer?"client":"server";if(!this._inflate){const e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?St.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=St.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[Ct]=this,this._inflate[Nt]=0,this._inflate[$t]=[],this._inflate.on("error",Dt),this._inflate.on("data",jt)}this._inflate[Rt]=r,this._inflate.write(e),t&&this._inflate.write(xt),this._inflate.flush((()=>{const e=this._inflate[Pt];if(e)return this._inflate.close(),this._inflate=null,void r(e);const i=At.concat(this._inflate[$t],this._inflate[Nt]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Nt]=0,this._inflate[$t]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,i)}))}_compress(e,t,r){const n=this._isServer?"server":"client";if(!this._deflate){const e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?St.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=St.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[Nt]=0,this._deflate[$t]=[],this._deflate.on("data",Ut)}this._deflate[Rt]=r,this._deflate.write(e),this._deflate.flush(St.Z_SYNC_FLUSH,(()=>{if(!this._deflate)return;let e=At.concat(this._deflate[$t],this._deflate[Nt]);t&&(e=e.slice(0,e.length-4)),this._deflate[Rt]=null,this._deflate[Nt]=0,this._deflate[$t]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,e)}))}};function Ut(e){this[$t].push(e),this[Nt]+=e.length}function jt(e){this[Nt]+=e.length,this[Ct]._maxPayload<1||this[Nt]<=this[Ct]._maxPayload?this[$t].push(e):(this[Pt]=new RangeError("Max payload size exceeded"),this[Pt].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Pt][Ot]=1009,this.removeListener("data",jt),this.reset())}function Dt(e){this[Ct]._inflate=null,e[Ot]=1007,this[Rt](e)}var Mt={exports:{}};function It(e){const t=e.length;let r=0;for(;r<t;)if(128&e[r])if(192==(224&e[r])){if(r+1===t||128!=(192&e[r+1])||192==(254&e[r]))return!1;r+=2}else if(224==(240&e[r])){if(r+2>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||224===e[r]&&128==(224&e[r+1])||237===e[r]&&160==(224&e[r+1]))return!1;r+=3}else{if(240!=(248&e[r]))return!1;if(r+3>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||128!=(192&e[r+3])||240===e[r]&&128==(240&e[r+1])||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}else r++;return!0}if(Mt.exports={isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:It,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},!process.env.WS_NO_UTF_8_VALIDATE)try{const e=require("utf-8-validate");Mt.exports.isValidUTF8=function(t){return t.length<150?It(t):e(t)}}catch(e){}var Ft=Mt.exports;const{Writable:Wt}=a,qt=Lt,{BINARY_TYPES:Kt,EMPTY_BUFFER:zt,kStatusCode:Ht,kWebSocket:Vt}=gt,{concat:Yt,toArrayBuffer:Gt,unmask:Jt}=wt,{isValidStatusCode:Xt,isValidUTF8:Qt}=Ft;var Zt=class extends Wt{constructor(e={}){super(),this._binaryType=e.binaryType||Kt[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Vt]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(48&e[0])return this._loop=!1,er(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const t=!(64&~e[0]);if(t&&!this._extensions[qt.extensionName])return this._loop=!1,er(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=!(128&~e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,er(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,er(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,er(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,er(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin)return this._loop=!1,er(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,er(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,er(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~e[1]),this._isServer){if(!this._masked)return this._loop=!1,er(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,er(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,er(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,er(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=zt;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&Jt(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[qt.extensionName].decompress(e,this._fin,((e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(er(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(r)}const n=this.dataMessage();if(n)return t(n);this.startLoop(t)}))}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r="nodebuffer"===this._binaryType?Yt(t,e):"arraybuffer"===this._binaryType?Gt(Yt(t,e)):t,this.emit("message",r,!0)}else{const r=Yt(t,e);if(!this._skipUTF8Validation&&!Qt(r))return this._loop=!1,er(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",r,!1)}}this._state=0}controlMessage(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit("conclude",1005,zt),this.end();else{if(1===e.length)return er(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{const t=e.readUInt16BE(0);if(!Xt(t))return er(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const r=e.slice(2);if(!this._skipUTF8Validation&&!Qt(r))return er(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,r),this.end()}}else 9===this._opcode?this.emit("ping",e):this.emit("pong",e);this._state=0}};function er(e,t,r,n,i){const s=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,er),s.code=i,s[Ht]=n,s}const{randomFillSync:tr}=t,rr=Lt,{EMPTY_BUFFER:nr}=gt,{isValidStatusCode:ir}=Ft,{mask:sr,toBuffer:or}=wt,ar=Symbol("kByteLength"),cr=Buffer.alloc(4);var hr=class e{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r,n,i=!1,s=2,o=!1;t.mask&&(r=t.maskBuffer||cr,t.generateMask?t.generateMask(r):tr(r,0,4),o=!(r[0]|r[1]|r[2]|r[3]),s=6),"string"==typeof e?n=t.mask&&!o||void 0===t[ar]?(e=Buffer.from(e)).length:t[ar]:(n=e.length,i=t.mask&&t.readOnly&&!o);let a=n;n>=65536?(s+=8,a=127):n>125&&(s+=2,a=126);const c=Buffer.allocUnsafe(i?n+s:s);return c[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(c[0]|=64),c[1]=a,126===a?c.writeUInt16BE(n,2):127===a&&(c[2]=c[3]=0,c.writeUIntBE(n,4,6)),t.mask?(c[1]|=128,c[s-4]=r[0],c[s-3]=r[1],c[s-2]=r[2],c[s-1]=r[3],o?[c,e]:i?(sr(e,r,c,s,n),[c]):(sr(e,r,e,0,n),[c,e])):[c,e]}close(t,r,n,i){let s;if(void 0===t)s=nr;else{if("number"!=typeof t||!ir(t))throw new TypeError("First argument must be a valid error code number");if(void 0!==r&&r.length){const e=Buffer.byteLength(r);if(e>123)throw new RangeError("The message must not be greater than 123 bytes");s=Buffer.allocUnsafe(2+e),s.writeUInt16BE(t,0),"string"==typeof r?s.write(r,2):s.set(r,2)}else s=Buffer.allocUnsafe(2),s.writeUInt16BE(t,0)}const o={[ar]:s.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,s,!1,o,i]):this.sendFrame(e.frame(s,o),i)}ping(t,r,n){let i,s;if("string"==typeof t?(i=Buffer.byteLength(t),s=!1):(i=(t=or(t)).length,s=or.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[ar]:i,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};this._deflating?this.enqueue([this.dispatch,t,!1,o,n]):this.sendFrame(e.frame(t,o),n)}pong(t,r,n){let i,s;if("string"==typeof t?(i=Buffer.byteLength(t),s=!1):(i=(t=or(t)).length,s=or.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[ar]:i,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};this._deflating?this.enqueue([this.dispatch,t,!1,o,n]):this.sendFrame(e.frame(t,o),n)}send(t,r,n){const i=this._extensions[rr.extensionName];let s,o,a=r.binary?2:1,c=r.compress;if("string"==typeof t?(s=Buffer.byteLength(t),o=!1):(s=(t=or(t)).length,o=or.readOnly),this._firstFragment?(this._firstFragment=!1,c&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(c=s>=i._threshold),this._compress=c):(c=!1,a=0),r.fin&&(this._firstFragment=!0),i){const e={[ar]:s,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:o,rsv1:c};this._deflating?this.enqueue([this.dispatch,t,this._compress,e,n]):this.dispatch(t,this._compress,e,n)}else this.sendFrame(e.frame(t,{[ar]:s,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:o,rsv1:!1}),n)}dispatch(t,r,n,i){if(!r)return void this.sendFrame(e.frame(t,n),i);const s=this._extensions[rr.extensionName];this._bufferedBytes+=n[ar],this._deflating=!0,s.compress(t,n.fin,((t,r)=>{if(this._socket.destroyed){const e=new Error("The socket was closed while data was being compressed");"function"==typeof i&&i(e);for(let t=0;t<this._queue.length;t++){const r=this._queue[t],n=r[r.length-1];"function"==typeof n&&n(e)}}else this._bufferedBytes-=n[ar],this._deflating=!1,n.readOnly=!1,this.sendFrame(e.frame(r,n),i),this.dequeue()}))}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][ar],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][ar],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};const{kForOnEventAttribute:lr,kListener:ur}=gt,fr=Symbol("kCode"),dr=Symbol("kData"),pr=Symbol("kError"),yr=Symbol("kMessage"),_r=Symbol("kReason"),gr=Symbol("kTarget"),mr=Symbol("kType"),vr=Symbol("kWasClean");class br{constructor(e){this[gr]=null,this[mr]=e}get target(){return this[gr]}get type(){return this[mr]}}Object.defineProperty(br.prototype,"target",{enumerable:!0}),Object.defineProperty(br.prototype,"type",{enumerable:!0});class wr extends br{constructor(e,t={}){super(e),this[fr]=void 0===t.code?0:t.code,this[_r]=void 0===t.reason?"":t.reason,this[vr]=void 0!==t.wasClean&&t.wasClean}get code(){return this[fr]}get reason(){return this[_r]}get wasClean(){return this[vr]}}Object.defineProperty(wr.prototype,"code",{enumerable:!0}),Object.defineProperty(wr.prototype,"reason",{enumerable:!0}),Object.defineProperty(wr.prototype,"wasClean",{enumerable:!0});class Er extends br{constructor(e,t={}){super(e),this[pr]=void 0===t.error?null:t.error,this[yr]=void 0===t.message?"":t.message}get error(){return this[pr]}get message(){return this[yr]}}Object.defineProperty(Er.prototype,"error",{enumerable:!0}),Object.defineProperty(Er.prototype,"message",{enumerable:!0});class kr extends br{constructor(e,t={}){super(e),this[dr]=void 0===t.data?null:t.data}get data(){return this[dr]}}Object.defineProperty(kr.prototype,"data",{enumerable:!0});const Sr={addEventListener(e,t,r={}){for(const n of this.listeners(e))if(!r[lr]&&n[ur]===t&&!n[lr])return;let n;if("message"===e)n=function(e,r){const n=new kr("message",{data:r?e:e.toString()});n[gr]=this,Tr(t,this,n)};else if("close"===e)n=function(e,r){const n=new wr("close",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});n[gr]=this,Tr(t,this,n)};else if("error"===e)n=function(e){const r=new Er("error",{error:e,message:e.message});r[gr]=this,Tr(t,this,r)};else{if("open"!==e)return;n=function(){const e=new br("open");e[gr]=this,Tr(t,this,e)}}n[lr]=!!r[lr],n[ur]=t,r.once?this.once(e,n):this.on(e,n)},removeEventListener(e,t){for(const r of this.listeners(e))if(r[ur]===t&&!r[lr]){this.removeListener(e,r);break}}};var Ar={CloseEvent:wr,ErrorEvent:Er,Event:br,EventTarget:Sr,MessageEvent:kr};function Tr(e,t,r){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}const{tokenChars:Or}=Ft;function xr(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}var Cr={format:function(e){return Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>[t].concat(Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>!0===e?t:`${t}=${e}`)).join("; ")}))).join("; "))).join(", ")})).join(", ")},parse:function(e){const t=Object.create(null);let r,n,i=Object.create(null),s=!1,o=!1,a=!1,c=-1,h=-1,l=-1,u=0;for(;u<e.length;u++)if(h=e.charCodeAt(u),void 0===r)if(-1===l&&1===Or[h])-1===c&&(c=u);else if(0===u||32!==h&&9!==h){if(59!==h&&44!==h)throw new SyntaxError(`Unexpected character at index ${u}`);{if(-1===c)throw new SyntaxError(`Unexpected character at index ${u}`);-1===l&&(l=u);const n=e.slice(c,l);44===h?(xr(t,n,i),i=Object.create(null)):r=n,c=l=-1}}else-1===l&&-1!==c&&(l=u);else if(void 0===n)if(-1===l&&1===Or[h])-1===c&&(c=u);else if(32===h||9===h)-1===l&&-1!==c&&(l=u);else if(59===h||44===h){if(-1===c)throw new SyntaxError(`Unexpected character at index ${u}`);-1===l&&(l=u),xr(i,e.slice(c,l),!0),44===h&&(xr(t,r,i),i=Object.create(null),r=void 0),c=l=-1}else{if(61!==h||-1===c||-1!==l)throw new SyntaxError(`Unexpected character at index ${u}`);n=e.slice(c,u),c=l=-1}else if(o){if(1!==Or[h])throw new SyntaxError(`Unexpected character at index ${u}`);-1===c?c=u:s||(s=!0),o=!1}else if(a)if(1===Or[h])-1===c&&(c=u);else if(34===h&&-1!==c)a=!1,l=u;else{if(92!==h)throw new SyntaxError(`Unexpected character at index ${u}`);o=!0}else if(34===h&&61===e.charCodeAt(u-1))a=!0;else if(-1===l&&1===Or[h])-1===c&&(c=u);else if(-1===c||32!==h&&9!==h){if(59!==h&&44!==h)throw new SyntaxError(`Unexpected character at index ${u}`);{if(-1===c)throw new SyntaxError(`Unexpected character at index ${u}`);-1===l&&(l=u);let o=e.slice(c,l);s&&(o=o.replace(/\\/g,""),s=!1),xr(i,n,o),44===h&&(xr(t,r,i),i=Object.create(null),r=void 0),n=void 0,c=l=-1}}else-1===l&&(l=u);if(-1===c||a||32===h||9===h)throw new SyntaxError("Unexpected end of input");-1===l&&(l=u);const f=e.slice(c,l);return void 0===r?xr(t,f,i):(void 0===n?xr(i,f,!0):xr(i,n,s?f.replace(/\\/g,""):f),xr(t,r,i)),t}};const Nr=u,Rr=o,$r=s,Pr=h,Br=l,{randomBytes:Lr,createHash:Ur}=t,{URL:jr}=n,Dr=Lt,Mr=Zt,Ir=hr,{BINARY_TYPES:Fr,EMPTY_BUFFER:Wr,GUID:qr,kForOnEventAttribute:Kr,kListener:zr,kStatusCode:Hr,kWebSocket:Vr,NOOP:Yr}=gt,{EventTarget:{addEventListener:Gr,removeEventListener:Jr}}=Ar,{format:Xr,parse:Qr}=Cr,{toBuffer:Zr}=wt,en=Symbol("kAborted"),tn=[8,13],rn=["CONNECTING","OPEN","CLOSING","CLOSED"],nn=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;let sn=class e extends Nr{constructor(t,r,n){super(),this._binaryType=Fr[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Wr,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=e.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==t?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===r?r=[]:Array.isArray(r)||("object"==typeof r&&null!==r?(n=r,r=[]):r=[r]),on(this,t,r,n)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){Fr.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(t,r,n){const i=new Mr({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation});this._sender=new Ir(t,this._extensions,n.generateMask),this._receiver=i,this._socket=t,i[Vr]=this,t[Vr]=this,i.on("conclude",fn),i.on("drain",dn),i.on("error",pn),i.on("message",_n),i.on("ping",gn),i.on("pong",mn),t.setTimeout(0),t.setNoDelay(),r.length>0&&t.unshift(r),t.on("close",bn),t.on("data",wn),t.on("end",En),t.on("error",kn),this._readyState=e.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=e.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[Dr.extensionName]&&this._extensions[Dr.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=e.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(t,r){if(this.readyState!==e.CLOSED){if(this.readyState===e.CONNECTING){const e="WebSocket was closed before the connection was established";return ln(this,this._req,e)}this.readyState!==e.CLOSING?(this._readyState=e.CLOSING,this._sender.close(t,r,!this._isServer,(e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())})),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==e.CONNECTING&&this.readyState!==e.CLOSED&&(this._paused=!0,this._socket.pause())}ping(t,r,n){if(this.readyState===e.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof t?(n=t,t=r=void 0):"function"==typeof r&&(n=r,r=void 0),"number"==typeof t&&(t=t.toString()),this.readyState===e.OPEN?(void 0===r&&(r=!this._isServer),this._sender.ping(t||Wr,r,n)):un(this,t,n)}pong(t,r,n){if(this.readyState===e.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof t?(n=t,t=r=void 0):"function"==typeof r&&(n=r,r=void 0),"number"==typeof t&&(t=t.toString()),this.readyState===e.OPEN?(void 0===r&&(r=!this._isServer),this._sender.pong(t||Wr,r,n)):un(this,t,n)}resume(){this.readyState!==e.CONNECTING&&this.readyState!==e.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(t,r,n){if(this.readyState===e.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof r&&(n=r,r={}),"number"==typeof t&&(t=t.toString()),this.readyState!==e.OPEN)return void un(this,t,n);const i={binary:"string"!=typeof t,mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[Dr.extensionName]||(i.compress=!1),this._sender.send(t||Wr,i,n)}terminate(){if(this.readyState!==e.CLOSED){if(this.readyState===e.CONNECTING){const e="WebSocket was closed before the connection was established";return ln(this,this._req,e)}this._socket&&(this._readyState=e.CLOSING,this._socket.destroy())}}};function on(e,t,r,n){const i={protocolVersion:tn[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!tn.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${tn.join(", ")})`);let s;if(t instanceof jr)s=t,e._url=t.href;else{try{s=new jr(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}e._url=t}const o="wss:"===s.protocol,a="ws+unix:"===s.protocol;let c;if("ws:"===s.protocol||o||a?a&&!s.pathname?c="The URL's pathname is empty":s.hash&&(c="The URL contains a fragment identifier"):c='The URL\'s protocol must be one of "ws:", "wss:", or "ws+unix:"',c){const t=new SyntaxError(c);if(0===e._redirects)throw t;return void an(e,t)}const h=o?443:80,l=Lr(16).toString("base64"),u=o?Rr.request:$r.request,f=new Set;let d,p;if(i.createConnection=o?hn:cn,i.defaultPort=i.defaultPort||h,i.port=s.port||h,i.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},i.path=s.pathname+s.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(d=new Dr(!0!==i.perMessageDeflate?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=Xr({[Dr.extensionName]:d.offer()})),r.length){for(const e of r){if("string"!=typeof e||!nn.test(e)||f.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");f.add(e)}i.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(s.username||s.password)&&(i.auth=`${s.username}:${s.password}`),a){const e=i.path.split(":");i.socketPath=e[0],i.path=e[1]}if(i.followRedirects){if(0===e._redirects){e._originalIpc=a,e._originalSecure=o,e._originalHostOrSocketPath=a?i.socketPath:s.host;const t=n&&n.headers;if(n={...n,headers:{}},t)for(const[e,r]of Object.entries(t))n.headers[e.toLowerCase()]=r}else if(0===e.listenerCount("redirect")){const t=a?!!e._originalIpc&&i.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&s.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!o)&&(delete i.headers.authorization,delete i.headers.cookie,t||delete i.headers.host,i.auth=void 0)}i.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),p=e._req=u(i),e._redirects&&e.emit("redirect",e.url,p)}else p=e._req=u(i);i.timeout&&p.on("timeout",(()=>{ln(e,p,"Opening handshake has timed out")})),p.on("error",(t=>{null===p||p[en]||(p=e._req=null,an(e,t))})),p.on("response",(s=>{const o=s.headers.location,a=s.statusCode;if(o&&i.followRedirects&&a>=300&&a<400){if(++e._redirects>i.maxRedirects)return void ln(e,p,"Maximum redirects exceeded");let s;p.abort();try{s=new jr(o,t)}catch(t){const r=new SyntaxError(`Invalid URL: ${o}`);return void an(e,r)}on(e,s,r,n)}else e.emit("unexpected-response",p,s)||ln(e,p,`Unexpected server response: ${s.statusCode}`)})),p.on("upgrade",((t,r,n)=>{if(e.emit("upgrade",t),e.readyState!==sn.CONNECTING)return;if(p=e._req=null,"websocket"!==t.headers.upgrade.toLowerCase())return void ln(e,r,"Invalid Upgrade header");const s=Ur("sha1").update(l+qr).digest("base64");if(t.headers["sec-websocket-accept"]!==s)return void ln(e,r,"Invalid Sec-WebSocket-Accept header");const o=t.headers["sec-websocket-protocol"];let a;if(void 0!==o?f.size?f.has(o)||(a="Server sent an invalid subprotocol"):a="Server sent a subprotocol but none was requested":f.size&&(a="Server sent no subprotocol"),a)return void ln(e,r,a);o&&(e._protocol=o);const c=t.headers["sec-websocket-extensions"];if(void 0!==c){if(!d){return void ln(e,r,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=Qr(c)}catch(t){return void ln(e,r,"Invalid Sec-WebSocket-Extensions header")}const n=Object.keys(t);if(1!==n.length||n[0]!==Dr.extensionName){return void ln(e,r,"Server indicated an extension that was not requested")}try{d.accept(t[Dr.extensionName])}catch(t){return void ln(e,r,"Invalid Sec-WebSocket-Extensions header")}e._extensions[Dr.extensionName]=d}e.setSocket(r,n,{generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})})),p.end()}function an(e,t){e._readyState=sn.CLOSING,e.emit("error",t),e.emitClose()}function cn(e){return e.path=e.socketPath,Pr.connect(e)}function hn(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=Pr.isIP(e.host)?"":e.host),Br.connect(e)}function ln(e,t,r){e._readyState=sn.CLOSING;const n=new Error(r);Error.captureStackTrace(n,ln),t.setHeader?(t[en]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(an,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function un(e,t,r){if(t){const r=Zr(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){r(new Error(`WebSocket is not open: readyState ${e.readyState} (${rn[e.readyState]})`))}}function fn(e,t){const r=this[Vr];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[Vr]&&(r._socket.removeListener("data",wn),process.nextTick(vn,r._socket),1005===e?r.close():r.close(e,t))}function dn(){const e=this[Vr];e.isPaused||e._socket.resume()}function pn(e){const t=this[Vr];void 0!==t._socket[Vr]&&(t._socket.removeListener("data",wn),process.nextTick(vn,t._socket),t.close(e[Hr])),t.emit("error",e)}function yn(){this[Vr].emitClose()}function _n(e,t){this[Vr].emit("message",e,t)}function gn(e){const t=this[Vr];t.pong(e,!t._isServer,Yr),t.emit("ping",e)}function mn(e){this[Vr].emit("pong",e)}function vn(e){e.resume()}function bn(){const e=this[Vr];let t;this.removeListener("close",bn),this.removeListener("data",wn),this.removeListener("end",En),e._readyState=sn.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[Vr]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",yn),e._receiver.on("finish",yn))}function wn(e){this[Vr]._receiver.write(e)||this.pause()}function En(){const e=this[Vr];e._readyState=sn.CLOSING,e._receiver.end(),this.end()}function kn(){const e=this[Vr];this.removeListener("error",kn),this.on("error",Yr),e&&(e._readyState=sn.CLOSING,this.destroy())}Object.defineProperty(sn,"CONNECTING",{enumerable:!0,value:rn.indexOf("CONNECTING")}),Object.defineProperty(sn.prototype,"CONNECTING",{enumerable:!0,value:rn.indexOf("CONNECTING")}),Object.defineProperty(sn,"OPEN",{enumerable:!0,value:rn.indexOf("OPEN")}),Object.defineProperty(sn.prototype,"OPEN",{enumerable:!0,value:rn.indexOf("OPEN")}),Object.defineProperty(sn,"CLOSING",{enumerable:!0,value:rn.indexOf("CLOSING")}),Object.defineProperty(sn.prototype,"CLOSING",{enumerable:!0,value:rn.indexOf("CLOSING")}),Object.defineProperty(sn,"CLOSED",{enumerable:!0,value:rn.indexOf("CLOSED")}),Object.defineProperty(sn.prototype,"CLOSED",{enumerable:!0,value:rn.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((e=>{Object.defineProperty(sn.prototype,e,{enumerable:!0})})),["open","error","close","message"].forEach((e=>{Object.defineProperty(sn.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[Kr])return t[zr];return null},set(t){for(const t of this.listeners(e))if(t[Kr]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[Kr]:!0})}})})),sn.prototype.addEventListener=Gr,sn.prototype.removeEventListener=Jr;const Sn=w(sn),An=process.nextTick,Tn="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const On={websocket:class extends Ge{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=Tn?{}:Ke(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=new Sn(e,t,r)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"nodebuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;Le(r,this.supportsBinary,(e=>{const t={};if(r.options&&(t.compress=r.options.compress),this.opts.perMessageDeflate){("string"==typeof e?Buffer.byteLength(e):e.length)<this.opts.perMessageDeflate.threshold&&(t.compress=!1)}try{this.ws.send(e,t)}catch(e){}n&&An((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=nt()),this.supportsBinary||(e.b64=1);const n=it(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!Sn}},polling:class extends Ge{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=dt&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(Fe),n=[];for(let e=0;e<r.length;e++){const i=De(r[e],t);if(n.push(i),"error"===i.type)break}return n})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let i=0;e.forEach(((e,s)=>{Le(e,!1,(e=>{n[s]=e,++i===r&&t(n.join(Fe))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=nt()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const n=it(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new pt(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},xn=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Cn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Nn(e){const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let i=xn.exec(e||""),s={},o=14;for(;o--;)s[Cn[o]]=i[o]||"";return-1!=r&&-1!=n&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1);"/"==t.slice(-1)&&n.splice(n.length-1,1);return n}(0,s.path),s.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(r[t]=n)})),r}(0,s.query),s}let Rn=class e extends We{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=Nn(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Nn(t.host).host),Ve(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,n=r.length;e<n;e++){let n=r[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new On[e](r)}open(){let t;if(this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(t){let r=this.createTransport(t),n=!1;e.priorWebsocketSuccess=!1;const i=()=>{n||(r.send([{type:"ping",data:"probe"}]),r.once("packet",(t=>{if(!n)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;e.priorWebsocketSuccess="websocket"===r.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(l(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=r.name,this.emitReserved("upgradeError",e)}})))};function s(){n||(n=!0,l(),r.close(),r=null)}const o=e=>{const t=new Error("probe error: "+e);t.transport=r.name,s(),this.emitReserved("upgradeError",t)};function a(){o("transport closed")}function c(){o("socket closed")}function h(e){r&&e.name!==r.name&&s()}const l=()=>{r.removeListener("open",i),r.removeListener("error",o),r.removeListener("close",a),this.off("close",c),this.off("upgrading",h)};r.once("open",i),r.once("error",o),r.once("close",a),this.once("close",c),this.once("upgrading",h),r.open()}onOpen(){if(this.readyState="open",e.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(e+="string"==typeof(t=n)?function(e){let t=0,r=0;for(let n=0,i=e.length;n<i;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(t):Math.ceil(1.33*(t.byteLength||t.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}var t;return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(t){e.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}};Rn.protocol=4;const $n="function"==typeof ArrayBuffer,Pn=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Bn=Object.prototype.toString,Ln="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Bn.call(Blob),Un="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Bn.call(File);function jn(e){return $n&&(e instanceof ArrayBuffer||Pn(e))||Ln&&e instanceof Blob||Un&&e instanceof File}function Dn(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(Dn(e[t]))return!0;return!1}if(jn(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Dn(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&Dn(e[t]))return!0;return!1}function Mn(e){const t=[],r=e.data,n=e;return n.data=In(r,t),n.attachments=t.length,{packet:n,buffers:t}}function In(e,t){if(!e)return e;if(jn(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=In(e[n],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=In(e[n],t));return r}return e}function Fn(e,t){return e.data=Wn(e.data,t),delete e.attachments,e}function Wn(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=Wn(e[r],t);else if("object"==typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=Wn(e[r],t));return e}const qn=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var Kn;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Kn||(Kn={}));function zn(e){return"[object Object]"===Object.prototype.toString.call(e)}class Hn extends We{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Kn.BINARY_EVENT;r||t.type===Kn.BINARY_ACK?(t.type=r?Kn.EVENT:Kn.ACK,this.reconstructor=new Vn(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!jn(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===Kn[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Kn.BINARY_EVENT||r.type===Kn.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(n,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!Hn.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case Kn.CONNECT:return zn(t);case Kn.DISCONNECT:return void 0===t;case Kn.CONNECT_ERROR:return"string"==typeof t||zn(t);case Kn.EVENT:case Kn.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===qn.indexOf(t[0]));case Kn.ACK:case Kn.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Vn{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Fn(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var Yn=Object.freeze({__proto__:null,Decoder:Hn,Encoder:class{constructor(e){this.replacer=e}encode(e){return e.type!==Kn.EVENT&&e.type!==Kn.ACK||!Dn(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Kn.EVENT?Kn.BINARY_EVENT:Kn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Kn.BINARY_EVENT&&e.type!==Kn.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Mn(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}},get PacketType(){return Kn},protocol:5});function Gn(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const Jn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Xn extends We{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Gn(e,"open",this.onopen.bind(this)),Gn(e,"packet",this.onpacket.bind(this)),Gn(e,"error",this.onerror.bind(this)),Gn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Jn.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Kn.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,n=t.pop();this._registerAckCallback(e,n),r.id=e}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const n=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===n)return void(this.acks[e]=t);const i=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),n);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(i),t.apply(this,[null,...e])}}emitWithAck(e,...t){const r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((n,i)=>{t.push(((e,t)=>r?e?i(e):n(t):n(e))),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...n)=>{if(r!==this._queue[0])return;return null!==e?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...n)),r.pending=!1,this._drainQueue()})),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Kn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Kn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Kn.EVENT:case Kn.BINARY_EVENT:this.onevent(e);break;case Kn.ACK:case Kn.BINARY_ACK:this.onack(e);break;case Kn.DISCONNECT:this.ondisconnect();break;case Kn.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:Kn.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Kn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Qn(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Qn.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+r:e-r}return 0|Math.min(e,this.max)},Qn.prototype.reset=function(){this.attempts=0},Qn.prototype.setMin=function(e){this.ms=e},Qn.prototype.setMax=function(e){this.max=e},Qn.prototype.setJitter=function(e){this.jitter=e};class Zn extends We{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Ve(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Qn({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||Yn;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Rn(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=Gn(t,"open",(function(){r.onopen(),e&&e()})),i=Gn(t,"error",(t=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",t),e?e(t):r.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;0===e&&n();const r=this.setTimeoutFn((()=>{n(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Gn(e,"ping",this.onping.bind(this)),Gn(e,"data",this.ondata.bind(this)),Gn(e,"error",this.onerror.bind(this)),Gn(e,"close",this.onclose.bind(this)),Gn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){An((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Xn(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const e of t){if(this.nsps[e].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ei={};function ti(e,t){"object"==typeof e&&(t=e,e=void 0);const r=function(e,t="",r){let n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),n=Nn(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+t,n.href=n.protocol+"://"+i+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=r.source,i=r.id,s=r.path,o=ei[i]&&s in ei[i].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new Zn(n,t):(ei[i]||(ei[i]=new Zn(n,t)),a=ei[i]),r.query&&!t.query&&(t.query=r.queryKey),a.socket(r.path,t)}Object.assign(ti,{Manager:Zn,Socket:Xn,io:ti,connect:ti});const ri={_readDocument:(e,t)=>`${e}/${t?he(ri._readDocument(e)):"_readDocument"}`,_writeDocument:(e,t)=>`${e}/${t?he(ri._writeDocument(e)):"_writeDocument"}`,_deleteCollection:(e,t)=>`${e}/${t?he(ri._deleteCollection(e)):"_deleteCollection"}`,_queryCollection:(e,t)=>`${e}/${t?he(ri._queryCollection(e)):"_queryCollection"}`,_writeMapDocument:(e,t)=>`${e}/${t?he(ri._writeMapDocument(e)):"_writeMapDocument"}`,_customSignin:(e,t)=>`${e}/${t?he(ri._customSignin(e)):"_customSignin"}`,_customSignup:(e,t)=>`${e}/${t?he(ri._customSignup(e)):"_customSignup"}`,_googleSignin:(e,t)=>`${e}/${t?he(ri._googleSignin(e)):"_googleSignin"}`,_appleSignin:(e,t)=>`${e}/${t?he(ri._appleSignin(e)):"_appleSignin"}`,_facebookSignin:(e,t)=>`${e}/${t?he(ri._facebookSignin(e)):"_facebookSignin"}`,_twitterSignin:(e,t)=>`${e}/${t?he(ri._twitterSignin(e)):"_twitterSignin"}`,_githubSignin:(e,t)=>`${e}/${t?he(ri._githubSignin(e)):"_githubSignin"}`,_signOut:(e,t)=>`${e}/${t?he(ri._signOut(e)):"_signOut"}`,_invalidateToken:(e,t)=>`${e}/${t?he(ri._invalidateToken(e)):"_invalidateToken"}`,_refreshAuthToken:(e,t)=>`${e}/${t?he(ri._refreshAuthToken(e)):"_refreshAuthToken"}`,_downloadFile:(e,t)=>`${e}/${t?he(ri._downloadFile(e)):"_downloadFile"}`,_uploadFile:(e,t)=>`${e}/${t?he(ri._uploadFile(e)):"_uploadFile"}`,_deleteFile:(e,t)=>`${e}/${t?he(ri._deleteFile(e)):"_deleteFile"}`,_deleteFolder:(e,t)=>`${e}/${t?he(ri._deleteFolder(e)):"_deleteFolder"}`,staticStorage:(e,t)=>`${e}/${t?he(ri.staticStorage(e)):"storage"}`,_documentCount:(e,t)=>`${e}/${t?he(ri._documentCount(e)):"_documentCount"}`,_areYouOk:(e,t)=>`${e}/${t?he(ri._areYouOk(e)):"_areYouOk"}`,_listenCollection:e=>`${e?he(ri._listenCollection()):"_listenCollection"}`,_listenDocument:e=>`${e?he(ri._listenDocument()):"_listenDocument"}`,_startDisconnectWriteTask:e=>`${e?he(ri._startDisconnectWriteTask()):"_startDisconnectWriteTask"}`,_cancelDisconnectWriteTask:e=>`${e?he(ri._cancelDisconnectWriteTask()):"_cancelDisconnectWriteTask"}`,_listenUserVerification:e=>`${e?he(ri._listenUserVerification()):"_listenUserVerification"}`};var ni={...ri};const ii=2147483647,si=(e,t)=>{let r;if(t>=ii){const n=setTimeout((()=>{r=si(e,t-ii)}),ii);r=()=>{clearTimeout(n)}}else{const n=setTimeout(e,t);r=()=>{clearTimeout(n)}}return()=>{r()}};var oi=w(si);const ai=(e,t)=>p.listenTo(t,((t,r)=>{void 0!==t&&e?.(t||null,r)}),!0),ci=async(e,{token:t,refreshToken:r})=>{const{projectUrl:n}=e;ke.AuthStore[n]={token:t,refreshToken:r},Ee.AuthJWTToken[n]=t,Ae(),li(n),fi(e)},hi=t=>{return JSON.parse((r=t.split(".")[1],e.Buffer.from(r,"base64").toString("utf8")));var r},li=async(e,t)=>{await Oe(),p.dispatch(e,ke.AuthStore[e]?.token||null,t)},ui=e=>new Promise((t=>{const r=y.listenTo(e,(e=>{"ready"===e&&(r(),t())}),!0)})),fi=async(e,t)=>{const{projectUrl:r,maxRetries:n}=e;await Oe();const{token:i}=ke.AuthStore[r]||{},s=i?hi(i):void 0;if(Ee.TokenRefreshTimer[r]?.(),i){const i=Date.now()>=1e3*s.exp-6e4,o=()=>di(e,++Ee.LastTokenRefreshRef[r],n,n,t);if(i||t)return y.dispatch(r),o();y.dispatch(r,"ready"),Ee.TokenRefreshTimer[r]=oi((()=>{y.dispatch(r),o()}),1e3*s.exp-6e4-Date.now())}else if(t)return y.dispatch(r,"ready"),Re("no_token_yet","No token is available to initiate a refresh").simpleError},di=(e,t,r=7,n=7,i)=>new Promise((async(s,o)=>{const{projectUrl:a,serverE2E_PublicKey:c,accessKey:h,uglify:l}=e,u=Re("process_lost","The token refresh process has been lost and replace with another one");try{const{token:r,refreshToken:n}=ke.AuthStore[a],[f,[d]]=Ne({body:{token:r,r_token:n},accessKey:h,uglify:l,serverE2E_PublicKey:c}),p=await(await fetch(ni._refreshAuthToken(a,l),f)).json();if(t!==Ee.LastTokenRefreshRef[a])return void o(u.simpleError);if(p.simpleError)throw p;const y=l?ce(p.e2e,c,d):p;ke.AuthStore[a]?(ke.AuthStore[a].token=y.result.token,Ee.AuthJWTToken[a]=y.result.token,s(y.result.token),li(a,!Ee.InitiatedForcedToken[a]&&i),i&&(Ee.InitiatedForcedToken[a]=!0),Ae(),fi(e),pi(e,r)):o(u.simpleError)}catch(i){if(i.simpleError)console.error(`refreshToken error: ${i.simpleError?.message}`),ki({...e}),o(i.simpleError);else if(r<=0)o(t===Ee.LastTokenRefreshRef[a]?u.simpleError:Re("retry_limit_reached","The retry limit has been reach and execution prematurely stopped").simpleError),console.error("refreshToken retry exceeded, waiting for 2min before starting another retry");else{const i=se((c=>{t!==Ee.LastTokenRefreshRef[a]?(o(u.simpleError),i()):c&&(i(),di(e,t,r-1,n).then(s,o))}),a)}}})),pi=async(e,t)=>{try{const{projectUrl:r,accessKey:n,uglify:i,serverE2E_PublicKey:s}=e;await xe(r);const[o]=Ne({body:{token:t},accessKey:n,uglify:i,serverE2E_PublicKey:s}),a=await(await fetch(ni._invalidateToken(r,i),o)).json();if(a.simpleError)throw a}catch(e){throw Z(e).simpleError}},{_listenUserVerification:yi,_signOut:_i,_customSignin:gi,_customSignup:mi,_googleSignin:vi}=ni;class bi{constructor(e){this.builder={...e}}customSignin=(e,t)=>wi(this.builder,e,t);customSignup=(e,t,r,n)=>Ei(this.builder,e,t,r,n);googleSignin=e=>Si(this.builder,e);appleSignin(){}facebookSignin(){}twitterSignin(){}githubSignin(){}listenVerifiedStatus(e,t){const{projectUrl:r,serverE2E_PublicKey:n,uglify:i,baseUrl:s,wsPrefix:o}=this.builder;let a,c,h=Ee.AuthJWTToken[r]||null,l=0;const u=async()=>{const h=++l;if(await ui(r),!Ee.AuthJWTToken[r])return void t?.(Re("user_login_required","You must be signed-in to use this method").simpleError);if(h!==l)return;const u=Ee.AuthJWTToken[r],[f,[d]]=i?ae({mtoken:u},void 0,n):[null,[]];a=ti(`${o}://${s}`,{auth:i?{e2e:f,_m_internal:!0}:{mtoken:u,_m_internal:!0},transports:["websocket","polling","flashsocket"]}),a.emit(yi(i)),a.on("onVerificationChanged",(([r,s])=>{const o=r?Z(r).simpleError:void 0;o?t?.(o):e?.(i?ce(s,n,d):s)})),a.on("connect",(()=>{c&&a.emit(yi(i))})),a.on("disconnect",(()=>{c=!0}))};u();const f=ai((e=>{(e||null)!==h&&(a?.close?.(),c=void 0,u()),h=e}),r);return()=>{a?.close?.(),f?.()}}listenAuthToken=e=>ai(e,this.builder.projectUrl);getAuthToken=()=>new Promise((e=>{const t=ai((r=>{t(),e(r||null)}),this.builder.projectUrl)}));listenAuth=e=>{let t;return ai(((r,n)=>{const{refreshToken:i}=ke.AuthStore[this.builder.projectUrl]||{};((!!r||null)!==t||n)&&e(r?{...hi(r),tokenManager:{refreshToken:i,accessToken:r}}:null),t=!!r||null}),this.builder.projectUrl)};getAuth=()=>new Promise((e=>{const t=this.listenAuth((r=>{t(),e(r)}))}));signOut=()=>ki(this.builder);forceRefreshToken=()=>fi(this.builder,!0)}const wi=(e,t,r)=>new Promise((async(n,i)=>{const{projectUrl:s,serverE2E_PublicKey:o,accessKey:a,uglify:c}=e;try{await Oe();const[i,[h]]=Ne({body:{_:`${he(t)}.${he(r)}`},accessKey:a,serverE2E_PublicKey:o,uglify:c}),l=await(await fetch(gi(s,c),i)).json();if(l.simpleError)throw l;const u=c?ce(l.e2e,o,h):l;n({user:hi(u.result.token),token:u.result.token,refreshToken:u.result.refreshToken}),await ci(e,u.result)}catch(e){i(Z(e).simpleError)}})),Ei=(e,t,r,n,i)=>new Promise((async(s,o)=>{const{projectUrl:a,serverE2E_PublicKey:c,accessKey:h,uglify:l}=e;try{await Oe();const[o,[u]]=Ne({body:{_:`${he(t)}.${he(r)}.${he(n||"").trim()}`,metadata:i},accessKey:h,serverE2E_PublicKey:c,uglify:l}),f=await(await fetch(mi(a,l),o)).json();if(f.simpleError)throw f;const d=l?ce(f.e2e,c,u):f;s({user:hi(d.result.token),token:d.result.token,refreshToken:d.result.refreshToken}),await ci(e,d.result)}catch(e){o(Z(e).simpleError)}})),ki=async e=>{await Oe();const{projectUrl:t,serverE2E_PublicKey:r,accessKey:n,uglify:i}=e,{token:s,refreshToken:o}=ke.AuthStore[t];if(y.dispatch(t),ke.AuthStore[t]&&delete ke.AuthStore[t],s&&delete Ee.AuthJWTToken[t],Object.keys(Se).forEach((e=>{ke[e]=Se[e]})),li(t),Ae(),fi(e),s){y.dispatch(t,"ready");try{await xe(t);const[e]=Ne({body:{token:s,r_token:o},accessKey:n,uglify:i,serverE2E_PublicKey:r}),a=await(await fetch(_i(t,i),e)).json();if(a.simpleError)throw a}catch(e){throw Z(e).simpleError}}},Si=(e,t)=>new Promise((async(r,n)=>{const{projectUrl:i,serverE2E_PublicKey:s,accessKey:o,uglify:a}=e;try{await Oe();const[n,[c]]=Ne({body:{token:t},accessKey:o,uglify:a,serverE2E_PublicKey:s}),h=await(await fetch(vi(i,a),n)).json();if(h.simpleError)throw h;const l=a?ce(h.e2e,s,c):h;r({user:hi(l.result.token),token:l.result.token,refreshToken:l.result.refreshToken,isNewUser:l.result.isNewUser}),await ci(e,l.result)}catch(e){n(Z(e).simpleError)}}));var Ai=Array.isArray,Ti="object"==typeof b&&b&&b.Object===Object&&b,Oi=Ti,xi="object"==typeof self&&self&&self.Object===Object&&self,Ci=Oi||xi||Function("return this")(),Ni=Ci.Symbol,Ri=Ni,$i=Object.prototype,Pi=$i.hasOwnProperty,Bi=$i.toString,Li=Ri?Ri.toStringTag:void 0;var Ui=function(e){var t=Pi.call(e,Li),r=e[Li];try{e[Li]=void 0;var n=!0}catch(e){}var i=Bi.call(e);return n&&(t?e[Li]=r:delete e[Li]),i},ji=Object.prototype.toString;var Di=Ui,Mi=function(e){return ji.call(e)},Ii=Ni?Ni.toStringTag:void 0;var Fi=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Ii&&Ii in Object(e)?Di(e):Mi(e)};var Wi=function(e){return null!=e&&"object"==typeof e},qi=Fi,Ki=Wi;var zi=function(e){return"symbol"==typeof e||Ki(e)&&"[object Symbol]"==qi(e)},Hi=Ai,Vi=zi,Yi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Gi=/^\w*$/;var Ji=function(e,t){if(Hi(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Vi(e))||(Gi.test(e)||!Yi.test(e)||null!=t&&e in Object(t))};var Xi=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Qi=Fi,Zi=Xi;var es,ts=function(e){if(!Zi(e))return!1;var t=Qi(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},rs=Ci["__core-js_shared__"],ns=(es=/[^.]+$/.exec(rs&&rs.keys&&rs.keys.IE_PROTO||""))?"Symbol(src)_1."+es:"";var is=function(e){return!!ns&&ns in e},ss=Function.prototype.toString;var os=function(e){if(null!=e){try{return ss.call(e)}catch(e){}try{return e+""}catch(e){}}return""},as=ts,cs=is,hs=Xi,ls=os,us=/^\[object .+?Constructor\]$/,fs=Function.prototype,ds=Object.prototype,ps=fs.toString,ys=ds.hasOwnProperty,_s=RegExp("^"+ps.call(ys).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var gs=function(e){return!(!hs(e)||cs(e))&&(as(e)?_s:us).test(ls(e))},ms=function(e,t){return null==e?void 0:e[t]};var vs=function(e,t){var r=ms(e,t);return gs(r)?r:void 0},bs=vs(Object,"create"),ws=bs;var Es=function(){this.__data__=ws?ws(null):{},this.size=0};var ks=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ss=bs,As=Object.prototype.hasOwnProperty;var Ts=function(e){var t=this.__data__;if(Ss){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return As.call(t,e)?t[e]:void 0},Os=bs,xs=Object.prototype.hasOwnProperty;var Cs=bs;var Ns=Es,Rs=ks,$s=Ts,Ps=function(e){var t=this.__data__;return Os?void 0!==t[e]:xs.call(t,e)},Bs=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Cs&&void 0===t?"__lodash_hash_undefined__":t,this};function Ls(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ls.prototype.clear=Ns,Ls.prototype.delete=Rs,Ls.prototype.get=$s,Ls.prototype.has=Ps,Ls.prototype.set=Bs;var Us=Ls;var js=function(){this.__data__=[],this.size=0};var Ds=function(e,t){return e===t||e!=e&&t!=t},Ms=Ds;var Is=function(e,t){for(var r=e.length;r--;)if(Ms(e[r][0],t))return r;return-1},Fs=Is,Ws=Array.prototype.splice;var qs=Is;var Ks=Is;var zs=Is;var Hs=js,Vs=function(e){var t=this.__data__,r=Fs(t,e);return!(r<0)&&(r==t.length-1?t.pop():Ws.call(t,r,1),--this.size,!0)},Ys=function(e){var t=this.__data__,r=qs(t,e);return r<0?void 0:t[r][1]},Gs=function(e){return Ks(this.__data__,e)>-1},Js=function(e,t){var r=this.__data__,n=zs(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Xs(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Xs.prototype.clear=Hs,Xs.prototype.delete=Vs,Xs.prototype.get=Ys,Xs.prototype.has=Gs,Xs.prototype.set=Js;var Qs=Xs,Zs=vs(Ci,"Map"),eo=Us,to=Qs,ro=Zs;var no=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var io=function(e,t){var r=e.__data__;return no(t)?r["string"==typeof t?"string":"hash"]:r.map},so=io;var oo=io;var ao=io;var co=io;var ho=function(){this.size=0,this.__data__={hash:new eo,map:new(ro||to),string:new eo}},lo=function(e){var t=so(this,e).delete(e);return this.size-=t?1:0,t},uo=function(e){return oo(this,e).get(e)},fo=function(e){return ao(this,e).has(e)},po=function(e,t){var r=co(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function yo(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}yo.prototype.clear=ho,yo.prototype.delete=lo,yo.prototype.get=uo,yo.prototype.has=fo,yo.prototype.set=po;var _o=yo,go=_o;function mo(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(mo.Cache||go),r}mo.Cache=go;var vo=mo;var bo=function(e){var t=vo(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t},wo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Eo=/\\(\\)?/g,ko=bo((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(wo,(function(e,r,n,i){t.push(n?i.replace(Eo,"$1"):r||e)})),t}));var So=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i},Ao=So,To=Ai,Oo=zi,xo=Ni?Ni.prototype:void 0,Co=xo?xo.toString:void 0;var No=function e(t){if("string"==typeof t)return t;if(To(t))return Ao(t,e)+"";if(Oo(t))return Co?Co.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r},Ro=No;var $o=Ai,Po=Ji,Bo=ko,Lo=function(e){return null==e?"":Ro(e)};var Uo=function(e,t){return $o(e)?e:Po(e,t)?[e]:Bo(Lo(e))},jo=zi;var Do=function(e){if("string"==typeof e||jo(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},Mo=Uo,Io=Do;var Fo=function(e,t){for(var r=0,n=(t=Mo(t,e)).length;null!=e&&r<n;)e=e[Io(t[r++])];return r&&r==n?e:void 0},Wo=Fo;var qo=w((function(e,t,r){var n=null==e?void 0:Wo(e,t);return void 0===n?r:n})),Ko=Qs;var zo=Qs,Ho=Zs,Vo=_o;var Yo=Qs,Go=function(){this.__data__=new Ko,this.size=0},Jo=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Xo=function(e){return this.__data__.get(e)},Qo=function(e){return this.__data__.has(e)},Zo=function(e,t){var r=this.__data__;if(r instanceof zo){var n=r.__data__;if(!Ho||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Vo(n)}return r.set(e,t),this.size=r.size,this};function ea(e){var t=this.__data__=new Yo(e);this.size=t.size}ea.prototype.clear=Go,ea.prototype.delete=Jo,ea.prototype.get=Xo,ea.prototype.has=Qo,ea.prototype.set=Zo;var ta=ea;var ra=_o,na=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},ia=function(e){return this.__data__.has(e)};function sa(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ra;++t<r;)this.add(e[t])}sa.prototype.add=sa.prototype.push=na,sa.prototype.has=ia;var oa=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var aa=function(e,t){return e.has(t)},ca=sa,ha=oa,la=aa;var ua=function(e,t,r,n,i,s){var o=1&r,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var h=s.get(e),l=s.get(t);if(h&&l)return h==t&&l==e;var u=-1,f=!0,d=2&r?new ca:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var p=e[u],y=t[u];if(n)var _=o?n(y,p,u,t,e,s):n(p,y,u,e,t,s);if(void 0!==_){if(_)continue;f=!1;break}if(d){if(!ha(t,(function(e,t){if(!la(d,t)&&(p===e||i(p,e,r,n,s)))return d.push(t)}))){f=!1;break}}else if(p!==y&&!i(p,y,r,n,s)){f=!1;break}}return s.delete(e),s.delete(t),f};var fa=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var da=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},pa=Ci.Uint8Array,ya=Ds,_a=ua,ga=fa,ma=da,va=Ni?Ni.prototype:void 0,ba=va?va.valueOf:void 0;var wa=function(e,t,r,n,i,s,o){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new pa(e),new pa(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ya(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=ga;case"[object Set]":var c=1&n;if(a||(a=ma),e.size!=t.size&&!c)return!1;var h=o.get(e);if(h)return h==t;n|=2,o.set(e,t);var l=_a(a(e),a(t),n,i,s,o);return o.delete(e),l;case"[object Symbol]":if(ba)return ba.call(e)==ba.call(t)}return!1};var Ea=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e},ka=Ea,Sa=Ai;var Aa=function(e,t,r){var n=t(e);return Sa(e)?n:ka(n,r(e))};var Ta=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s};var Oa=Ta,xa=function(){return[]},Ca=Object.prototype.propertyIsEnumerable,Na=Object.getOwnPropertySymbols,Ra=Na?function(e){return null==e?[]:(e=Object(e),Oa(Na(e),(function(t){return Ca.call(e,t)})))}:xa;var $a=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},Pa=Fi,Ba=Wi;var La=function(e){return Ba(e)&&"[object Arguments]"==Pa(e)},Ua=Wi,ja=Object.prototype,Da=ja.hasOwnProperty,Ma=ja.propertyIsEnumerable,Ia=La(function(){return arguments}())?La:function(e){return Ua(e)&&Da.call(e,"callee")&&!Ma.call(e,"callee")},Fa={exports:{}};var Wa=function(){return!1};!function(e,t){var r=Ci,n=Wa,i=t&&!t.nodeType&&t,s=i&&e&&!e.nodeType&&e,o=s&&s.exports===i?r.Buffer:void 0,a=(o?o.isBuffer:void 0)||n;e.exports=a}(Fa,Fa.exports);var qa=Fa.exports,Ka=/^(?:0|[1-9]\d*)$/;var za=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Ka.test(e))&&e>-1&&e%1==0&&e<t};var Ha=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Va=Fi,Ya=Ha,Ga=Wi,Ja={};Ja["[object Float32Array]"]=Ja["[object Float64Array]"]=Ja["[object Int8Array]"]=Ja["[object Int16Array]"]=Ja["[object Int32Array]"]=Ja["[object Uint8Array]"]=Ja["[object Uint8ClampedArray]"]=Ja["[object Uint16Array]"]=Ja["[object Uint32Array]"]=!0,Ja["[object Arguments]"]=Ja["[object Array]"]=Ja["[object ArrayBuffer]"]=Ja["[object Boolean]"]=Ja["[object DataView]"]=Ja["[object Date]"]=Ja["[object Error]"]=Ja["[object Function]"]=Ja["[object Map]"]=Ja["[object Number]"]=Ja["[object Object]"]=Ja["[object RegExp]"]=Ja["[object Set]"]=Ja["[object String]"]=Ja["[object WeakMap]"]=!1;var Xa=function(e){return Ga(e)&&Ya(e.length)&&!!Ja[Va(e)]};var Qa=function(e){return function(t){return e(t)}},Za={exports:{}};!function(e,t){var r=Ti,n=t&&!t.nodeType&&t,i=n&&e&&!e.nodeType&&e,s=i&&i.exports===n&&r.process,o=function(){try{var e=i&&i.require&&i.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=o}(Za,Za.exports);var ec=Za.exports,tc=Xa,rc=Qa,nc=ec&&ec.isTypedArray,ic=nc?rc(nc):tc,sc=$a,oc=Ia,ac=Ai,cc=qa,hc=za,lc=ic,uc=Object.prototype.hasOwnProperty;var fc=function(e,t){var r=ac(e),n=!r&&oc(e),i=!r&&!n&&cc(e),s=!r&&!n&&!i&&lc(e),o=r||n||i||s,a=o?sc(e.length,String):[],c=a.length;for(var h in e)!t&&!uc.call(e,h)||o&&("length"==h||i&&("offset"==h||"parent"==h)||s&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||hc(h,c))||a.push(h);return a},dc=Object.prototype;var pc=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||dc)};var yc=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),_c=pc,gc=yc,mc=Object.prototype.hasOwnProperty;var vc=ts,bc=Ha;var wc=fc,Ec=function(e){if(!_c(e))return gc(e);var t=[];for(var r in Object(e))mc.call(e,r)&&"constructor"!=r&&t.push(r);return t},kc=function(e){return null!=e&&bc(e.length)&&!vc(e)};var Sc=Aa,Ac=Ra,Tc=function(e){return kc(e)?wc(e):Ec(e)};var Oc=function(e){return Sc(e,Tc,Ac)},xc=Object.prototype.hasOwnProperty;var Cc=function(e,t,r,n,i,s){var o=1&r,a=Oc(e),c=a.length;if(c!=Oc(t).length&&!o)return!1;for(var h=c;h--;){var l=a[h];if(!(o?l in t:xc.call(t,l)))return!1}var u=s.get(e),f=s.get(t);if(u&&f)return u==t&&f==e;var d=!0;s.set(e,t),s.set(t,e);for(var p=o;++h<c;){var y=e[l=a[h]],_=t[l];if(n)var g=o?n(_,y,l,t,e,s):n(y,_,l,e,t,s);if(!(void 0===g?y===_||i(y,_,r,n,s):g)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var m=e.constructor,v=t.constructor;m==v||!("constructor"in e)||!("constructor"in t)||"function"==typeof m&&m instanceof m&&"function"==typeof v&&v instanceof v||(d=!1)}return s.delete(e),s.delete(t),d},Nc=vs(Ci,"DataView"),Rc=Zs,$c=vs(Ci,"Promise"),Pc=vs(Ci,"Set"),Bc=vs(Ci,"WeakMap"),Lc=Fi,Uc=os,jc="[object Map]",Dc="[object Promise]",Mc="[object Set]",Ic="[object WeakMap]",Fc="[object DataView]",Wc=Uc(Nc),qc=Uc(Rc),Kc=Uc($c),zc=Uc(Pc),Hc=Uc(Bc),Vc=Lc;(Nc&&Vc(new Nc(new ArrayBuffer(1)))!=Fc||Rc&&Vc(new Rc)!=jc||$c&&Vc($c.resolve())!=Dc||Pc&&Vc(new Pc)!=Mc||Bc&&Vc(new Bc)!=Ic)&&(Vc=function(e){var t=Lc(e),r="[object Object]"==t?e.constructor:void 0,n=r?Uc(r):"";if(n)switch(n){case Wc:return Fc;case qc:return jc;case Kc:return Dc;case zc:return Mc;case Hc:return Ic}return t});var Yc=ta,Gc=ua,Jc=wa,Xc=Cc,Qc=Vc,Zc=Ai,eh=qa,th=ic,rh="[object Arguments]",nh="[object Array]",ih="[object Object]",sh=Object.prototype.hasOwnProperty;var oh=function(e,t,r,n,i,s){var o=Zc(e),a=Zc(t),c=o?nh:Qc(e),h=a?nh:Qc(t),l=(c=c==rh?ih:c)==ih,u=(h=h==rh?ih:h)==ih,f=c==h;if(f&&eh(e)){if(!eh(t))return!1;o=!0,l=!1}if(f&&!l)return s||(s=new Yc),o||th(e)?Gc(e,t,r,n,i,s):Jc(e,t,c,r,n,i,s);if(!(1&r)){var d=l&&sh.call(e,"__wrapped__"),p=u&&sh.call(t,"__wrapped__");if(d||p){var y=d?e.value():e,_=p?t.value():t;return s||(s=new Yc),i(y,_,r,n,s)}}return!!f&&(s||(s=new Yc),Xc(e,t,r,n,i,s))},ah=Wi;var ch=function e(t,r,n,i,s){return t===r||(null==t||null==r||!ah(t)&&!ah(r)?t!=t&&r!=r:oh(t,r,n,i,e,s))},hh=ch;var lh=w((function(e,t){return hh(e,t)}));const uh=["desc","asc","ascending","descending"],fh=(e,t=[])=>{const r=["excludeFields","returnOnly","extraction","episode","retrieval","disableAuth","disableMinimizer"].filter((e=>!t.includes(e)));if(e){if(!ee(e))throw"Invalid value assigned to 'config', expected a raw object";Object.entries(e).forEach((([e,t])=>{if(!r.includes(e))throw`unexpected property '${e}' found in config`;if("excludeFields"===e||"returnOnly"===e){if("string"!=typeof t&&!Array.isArray(t))throw`invalid value supplied to ${e}, expected either a string or array of string`;Array.isArray(t)&&t.forEach((t=>{if("string"!=typeof t)throw`invalid value supplied to ${e}, expected a string in array but got ${t}`}))}else if("extraction"===e)(Array.isArray(t)?t:[t]).forEach(((e,t)=>{const{limit:r,sort:n,direction:i,collection:s,find:o,findOne:a}=e;if("number"==typeof r&&(!te(r)||r<=0))throw`invalid value supplied to limit of extraction[${t}], expected a positive whole number but got ${r}`;if(n&&"string"!=typeof n)throw`invalid value supplied to sort in extraction[${t}], expected a string value but got ${n}`;if(s&&"string"!=typeof s)throw`invalid value supplied to collection in extraction[${t}], expected a string value but got ${s}`;if(i&&1!==i&&-1!==i&&!uh.includes(i))throw`invalid value supplied to direction in extraction[${t}], expected any of ${[1,-1,...uh]} but got ${i}`}));else if("episode"===e){if(0!==t&&1!==t)throw`invalid value supplied to ${e}, expected either 0 or 1 but got ${t}`}else if("retrieval"===e){const r=Object.values(ye);if(!r.includes(t))throw`invalid value supplied to ${e}, expected any of ${r} but got ${t}`}else{if("disableAuth"!==e&&"disableMinimizer"!==e)throw`unexpected property '${e}' found in config`;if("boolean"!=typeof t)throw`invalid value supplied to ${e}, expected a boolean value but got ${t}`}}))}},dh=(e={})=>Nh({},e),ph=e=>{if("string"!=typeof e||e.includes(".")||!e.trim())throw`invalid collection path "${e}", expected non-empty string and mustn't contain "."`},yh=(e,t)=>{const r=[[],[]];return Object.entries(t).forEach((([t,n])=>{if("$and"===t){if(!Array.isArray(n))throw"$and must be an array";n.forEach((t=>r[0].push(Nh(e,t))))}else if("$or"===t){if(!Array.isArray(n))throw"$and must be an array";n.forEach((t=>r[1].push(Nh(e,t))))}else r[0].push(Nh(e,{[`${t}`]:n}))})),!(r[0].filter((e=>!e)).length||r[1].length&&!r[1].filter((e=>e)).length)},_h=["double","string","object","array","decimal","int","bool","date","null","number"],{$IN:gh,$NIN:mh,$GT:vh,$GTE:bh,$LT:wh,$LTE:Eh,$EQ:kh,$EXISTS:Sh,$REGEX:Ah,$NE:Th,$SIZE:Oh,$TEXT:xh,$TYPE:Ch}=ve,Nh=(e={},t={})=>{if(!ee(e))throw"data must be a raw object";if(!ee(t))throw`expected a raw object but got ${t}`;const r={...e},n=[];return re(t,[]).forEach((([e,t])=>{let i=e.map(((e,t)=>e.startsWith("$")?{$:e,i:t}:null)).filter((e=>e));if(i.length){const{$:s,i:o}=i[0],a=o?qo(r,e.filter(((e,t)=>t<o)).join(".")):null;if(!be.includes(s))throw`"${s}" operation is currently not supported`;if(s!==xh&&(o!==e.length-1||!o))throw`"${s} must be at the last position as an operator"`;if(s===gh){if(!Array.isArray(t))throw`The value assigned to "${s}" operator must be an array`;void 0!==a?n.push(!!(Array.isArray(a)?a:[a]).filter((e=>!!t.filter((t=>Rh(t,e))).length)).length):n.push(!1)}else if(s===mh){if(!Array.isArray(t))throw`The value assigned to "${s}" operator must be an array`;void 0!==a?n.push(!(Array.isArray(a)?a:[a]).filter((e=>!!t.filter((t=>Rh(t,e))).length)).length):n.push(!0)}else if(s===vh)void 0!==a?n.push(!!(Array.isArray(a)?a:[a]).filter((e=>e>t)).length):n.push(!1);else if(s===bh)void 0!==a?n.push(!!(Array.isArray(a)?a:[a]).filter((e=>e>=t)).length):n.push(!1);else if(s===wh)void 0!==a?n.push(!!(Array.isArray(a)?a:[a]).filter((e=>e<t)).length):n.push(!1);else if(s===Eh)void 0!==a?n.push(!!(Array.isArray(a)?a:[a]).filter((e=>e<=t)).length):n.push(!1);else if(s===xh){if("$search"===i.slice(-1)[0].$){const{$caseSensitive:e,$localFields:i=[],$search:s}=r.$text;if("string"!=typeof t||"string"!=typeof s)throw"$search must have a string value";const o=i.map((e=>qo(r,e||""))).map((e=>`${"string"==typeof e?e:Array.isArray(e)?e.map((e=>"string"==typeof e?e:"")).join(" ").trim():""}`.trim())).join(" ").trim();n.push(e?o.includes(t.trim()):o.toLowerCase().includes(t.toLowerCase().trim()))}}else if(s===kh);else if(s===Sh);else if(s===Ah);else if(s===Th);else if(s===Oh){if(!te(t)||v<0)throw"$size must be a positive whole number";n.push(Array.isArray(a)&&a.length===t)}else if(s===Ch){if(!_h.includes(t))throw`invalid value supplied to ${s}, mosquioto-transport only recognise "${_h}" data types`;const e=e=>{if("number"==typeof e){if(isNaN(e))return("decimal"===t||"double"===t)&&(e=>"number"==typeof e&&`${e}`.includes("."))(e)||"int"===t||"number"===t}else{if("boolean"==typeof e)return"bool"===t;if("string"==typeof e)return"string"===t;if(null===e)return"null"===t;if(e instanceof RegExp)return"regex"===t;if(e instanceof Date)return"date"===t;if(ee(e))return"object"===t}return!1};n.push(Array.isArray(a)&&"array"===t||!!(Array.isArray(a)?a:[a]).filter((t=>e(t))).length)}}else{const i=qo(r,e.join("."));void 0!==i?n.push(!!(Array.isArray(i)?i:[i]).filter((e=>!!Rh(t,e))).length):n.push(!1)}})),!n.filter((e=>!e)).length},Rh=(e,t)=>e instanceof RegExp?"string"==typeof t&&e.test(t):lh(e,t);var $h=vs,Ph=function(){try{var e=$h(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var Bh=function(e,t,r){"__proto__"==t&&Ph?Ph(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},Lh=Ds,Uh=Object.prototype.hasOwnProperty;var jh=function(e,t,r){var n=e[t];Uh.call(e,t)&&Lh(n,r)&&(void 0!==r||t in e)||Bh(e,t,r)},Dh=Uo,Mh=za,Ih=Xi,Fh=Do;var Wh=function(e,t,r,n){if(!Ih(e))return e;for(var i=-1,s=(t=Dh(t,e)).length,o=s-1,a=e;null!=a&&++i<s;){var c=Fh(t[i]),h=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var l=a[c];void 0===(h=n?n(l,c,a):void 0)&&(h=Ih(l)?l:Mh(t[i+1])?[]:{})}jh(a,c,h),a=a[c]}return e},qh=Wh;var Kh=w((function(e,t,r){return null==e?e:qh(e,t,r)}));var zh=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var Hh=function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s},Vh=Fo,Yh=Hh;var Gh=Uo,Jh=zh,Xh=function(e,t){return t.length<2?e:Vh(e,Yh(t,0,-1))},Qh=Do;var Zh=function(e,t){return t=Gh(t,e),null==(e=Xh(e,t))||delete e[Qh(Jh(t))]};var el=w((function(e,t){return null==e||Zh(e,t)}));const tl=async(e,t,r,n)=>{await Oe();const{projectUrl:i,dbUrl:s=de,dbName:o=fe,path:a}=e,{extraction:c,excludeFields:h,returnOnly:l}=r?.config,u=`${ne(c||{})},${(h||[]).join(",")},${(l||[]).join(",")}`,f=qo(ke.DatabaseStore,[i,s,o,a,"data",u],[]);(Array.isArray(n)?n:[n]).forEach((e=>{const t=f.findIndex((t=>t._id===e._id));-1===t?f.push(e):f[t]=e})),Kh(ke.DatabaseStore,[i,s,o,a,"data",u],[...f]),Kh(ke.DatabaseStore,[i,s,o,a,"record",t],{query:r,result:n,registeredOn:Date.now()}),Ae()},rl=async(e,t)=>{await Oe();const{projectUrl:r,dbUrl:n=de,dbName:i=fe,path:s,command:o}=e,{config:a,find:c,findOne:h,sort:l,direction:u,limit:f,random:d}=o,{extraction:p,excludeFields:y,returnOnly:_}=a||{},g=`${ne(p||{})},${(y||[]).join(",")},${(_||[]).join(",")}`,m=qo(ke.DatabaseStore,[r,n,i,s,"data",g],[]),v=qo(ke.DatabaseStore,[r,n,i,s,"record",t]);if(!v)return null;let b=m.filter((e=>yh(e,h||c||{})));return d?b=(e=>{const t=[...e];let r,n=t.length;for(;0!=n;)r=Math.floor(Math.random()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t})(b):l&&(b=function(e=[],t){return e.slice(0).sort((function(e,r){const n=getLodash(e,t),i=getLodash(r,t);return n>i?1:n<i?-1:0}))}(b,l),-1!==u&&"desc"!==u&&"descending"!==u||(b=b.reverse())),h?b=b[0]:f&&b.filter(((e,t)=>t<f)),[b,v.result]},nl=(e,t)=>{const{command:r,path:n,countDoc:i}=e,{find:s,findOne:o,sort:a,direction:c,limit:h}=r||{},{extraction:l,retrieval:u=ye.DEFAULT,delivery:f=_e.DEFAULT,excludeFields:d=[],returnOnly:p=[]}=t||{};return`collection:${n}->excludes:${(Array.isArray(d)?d:[d]).filter((e=>void 0!==e)).join(",")}->includes:${(Array.isArray(p)?p:[p]).filter((e=>void 0!==e)).join(",")}->${i?"countDoc:yes->":""}sort:${a||""}->direction:${c||""}->limit:${h||""}->${o?"findOne":"find"}:${ne(o||s||{})}:extraction:${ne(l||{})}:retrieval:${u}:delivery:${f}`},il=e=>{const t={};return re(e,[]).forEach((([e,r])=>{if(e[0].startsWith("$"))throw`unexpected field "${e[0]}"`;"$timestamp"===e.slice(-1)[0]&&"now"===r&&(e.pop(),r=Date.now()),Kh(t,e.join("."),r)})),t},sl=(e,t)=>{const r={...e},n={};return re(t,[]).forEach((([i,s])=>{const[o,a]=[i[0],i.filter(((e,t)=>t))];if(!me.includes(o)||!a.length)throw"MongoInvalidArgumentError: Update document requires atomic operators";a.length>1&&ee(t[o][a[0]])&&!n[a[0]]&&(n[a[0]]=!0,r[a[0]]={});const c=qo(e,a.join("."));if(o===ge.$UNSET)el(r,a.join("."));else{if([ge.$MAX,ge.$MIN,ge.$INC,ge.$MUL].filter((e=>e===o)).length&&isNaN(s))throw`expected a number for "${o}" operation but got ${s}`;if("$timestamp"===a.slice(-1)[0]&&"now"===s){const e=[ge.$SET,ge.$UNSET];if(!e.includes(o))throw`invalid operator for updating timestamp, expected any of ${e}`;a.pop(),s=Date.now()}if(o===ge.$RENAME){if(void 0===c)return;if("string"!=typeof s)throw`${o} operator expected a string value at ${a.join(".")}`;el(r,a.join(".")),a[a.length-1]=s}Kh(r,a.join("."),o===ge.$SET?s:o===ge.$INC?isNaN(c)?s:c+s:o===ge.$MAX?isNaN(c)||s>c?s:c:o===ge.$MIN?isNaN(c)||s<c?s:c:o===ge.$MUL?isNaN(c)?0:s*c:o===ge.$PULL?Array.isArray(c)?c.filter((e=>!lh(e,s))):[s]:o===ge.$PUSH?Array.isArray(c)?[...c,s]:[s]:o===ge.$RENAME?c:null)}})),r};class ol{constructor(e){this.builder={...e}}find=e=>({get:t=>vl({...this.builder,command:{find:e}},t),listen:(t,r,n)=>_l(t,r,{...this.builder,command:{find:e}},n),count:t=>ml({...this.builder,command:{find:e}},t),limit:t=>({get:r=>vl({...this.builder,command:{find:e,limit:t}},r),random:r=>vl({...this.builder,command:{find:e,limit:t,random:!0}},r),listen:(r,n,i)=>_l(r,n,{...this.builder,command:{find:e,limit:t}},i),sort:(r,n)=>({get:i=>vl({...this.builder,command:{find:e,limit:t,sort:r,direction:n}},i),listen:(i,s,o)=>_l(i,s,{...this.builder,command:{find:e,limit:t,sort:r,direction:n}},o)})}),sort:(t,r)=>({get:n=>vl({...this.builder,command:{find:e,sort:t,direction:r}},n),listen:(n,i,s)=>_l(n,i,{...this.builder,command:{find:e,sort:t,direction:r}},s),limit:n=>({get:i=>vl({...this.builder,command:{find:e,sort:t,direction:r,limit:n}},i),listen:(i,s,o)=>_l(i,s,{...this.builder,command:{find:e,sort:t,direction:r,limit:n}},o)})})});sort=(e,t)=>this.find().sort(e,t);limit=e=>this.find().limit(e);count=e=>ml({...this.builder},e);get=e=>vl({...this.builder},e);listen=(e,t,r)=>_l(e,t,{...this.builder},r);findOne=(e={})=>({listen:(t,r,n)=>_l(t,r,{...this.builder,command:{findOne:e}},n),get:t=>vl({...this.builder,command:{findOne:e}},t)});onDisconnect=()=>({setOne:e=>gl({...this.builder},e,"setOne"),setMany:e=>gl({...this.builder},e,"setMany"),updateOne:(e,t)=>gl({...this.builder,command:{find:e}},t,"updateOne"),updateMany:(e,t)=>gl({...this.builder,command:{find:e}},t,"updateMany"),mergeOne:(e,t)=>gl({...this.builder,command:{find:e}},t,"mergeOne"),mergeMany:(e,t)=>gl({...this.builder,command:{find:e}},t,"mergeMany"),deleteOne:e=>gl({...this.builder,command:{find:e}},null,"deleteOne"),deleteMany:e=>gl({...this.builder,command:{find:e}},null,"deleteMany"),replaceOne:(e,t)=>gl({...this.builder,command:{find:e}},t,"replaceOne"),putOne:(e,t)=>gl({...this.builder,command:{find:e}},t,"putOne")});setOne=(e,t)=>bl(this.builder,e,"setOne",t);setMany=(e,t)=>bl(this.builder,e,"setMany",t);updateOne=(e,t,r)=>bl({...this.builder,find:e},t,"updateOne",r);updateMany=(e,t,r)=>bl({...this.builder,find:e},t,"updateMany",r);mergeOne=(e,t,r)=>bl({...this.builder,find:e},t,"mergeOne",r);mergeMany=(e,t,r)=>bl({...this.builder,find:e},t,"mergeMany",r);replaceOne=(e,t,r)=>bl({...this.builder,find:e},t,"replaceOne",r);putOne=(e,t,r)=>bl({...this.builder,find:e},t,"putOne",r);deleteOne=(e,t)=>bl({...this.builder,find:e},null,"deleteOne",t);deleteMany=(e,t)=>bl({...this.builder,find:e},null,"deleteMany",t)}const{_listenCollection:al,_listenDocument:cl,_startDisconnectWriteTask:hl,_cancelDisconnectWriteTask:ll,_documentCount:ul,_readDocument:fl,_queryCollection:dl,_writeDocument:pl,_writeMapDocument:yl}=ni,_l=(e,t,r,n)=>{const{projectUrl:i,wsPrefix:s,serverE2E_PublicKey:o,baseUrl:a,dbUrl:c,dbName:h,accessKey:l,path:u,disableCache:f,command:d,uglify:p}=r,{find:y,findOne:_,sort:g,direction:v,limit:b}=d,{disableAuth:w}=n||{},E=nl(r,n),k=!f,S=""+ ++Ee.AnyProcessIte;fh(n,["retrieval","disableAuth"]),dh(_||y),ph(u);let A,T,O,x,C,N,R=Ee.AuthJWTToken[i]||null,$=0;k&&(O=((e,{accessId:t,builder:r,config:n,processId:i})=>{let s="";const{episode:o=0}=n||{},a=m.listenTo(t,(async n=>{const a=await rl(r,t);a&&!lh(s,a[o])&&n===i&&e(a[o]),s=a[o]}));return()=>{s=void 0,a()}})(e,{accessId:E,builder:r,config:n,processId:S}),N=se((async e=>{N(),await Oe(),e||T||A||m.dispatch(E,S)}),i));const P=async()=>{const f=++$;if(w||await ui(i),A||f!==$)return;const d=w?void 0:Ee.AuthJWTToken[i],m={commands:{config:n,path:u,find:_||y,sort:g,direction:v,limit:b},dbName:h,dbUrl:c},[S,[O]]=p?ae({accessKey:l,_body:m},d,o):["",[]];x=ti(`${s}://${a}`,{auth:p?{e2e:S,_m_internal:!0}:{accessKey:l,_body:m,...d?{mtoken:d}:{},_m_internal:!0},transports:["websocket","polling","flashsocket"]}),x.emit((_?cl:al)(p)),x.on("mSnapshot",(async([i,s])=>{T=!0,i?t?.(Z(i).simpleError):(p&&(s=ce(s,o,O)),e?.(s),k&&tl(r,E,{sort:g,direction:v,limit:b,find:y,findOne:_,config:n},s))})),x.on("connect",(()=>{C&&x.emit((_?cl:al)(p))})),x.on("disconnect",(()=>{C=!0}))};P();const B=ai((e=>{(e||null)!==R&&(x?.close?.(),C=void 0,P()),R=e}),i);return()=>{A||(A=!0,N?.(),O?.(),B?.(),x&&x.close())}},gl=(e,t,r)=>{const{projectUrl:n,wsPrefix:i,baseUrl:s,serverE2E_PublicKey:o,dbUrl:a,dbName:c,accessKey:h,path:l,command:u,uglify:f}=e,{find:d}=u||{};ph(l);let p,y,_,g=Ee.AuthJWTToken[n]||null,m=0;const v=async()=>{const e=++m;if(await ui(n),p||e!==m)return;const u=Ee.AuthJWTToken[n],g={commands:{path:l,find:d,value:t,scope:r},dbName:c,dbUrl:a};y=ti(`${i}://${s}`,{auth:f?{e2e:ae(g,u,o)[0],_m_internal:!0}:{...u?{mtoken:u}:{},accessKey:h,_body:g,_m_internal:!0},transports:["websocket","polling","flashsocket"]}),y.emit(hl(f)),y.on("connect",(()=>{_&&y.emit(hl(f))})),y.on("disconnect",(()=>{_=!0}))};v();const b=ai((async e=>{(e||null)!==g&&(y&&(await oe((()=>y.timeout(1e4).emitWithAck(ll(f)))),y.close()),_=void 0,v()),g=e}),n);return()=>{p||(b(),y&&(async()=>{await oe((()=>y.timeout(1e4).emitWithAck(ll(f)))),y.close()})(),p=!0)}},ml=async(e,t)=>{const{projectUrl:r,serverE2E_PublicKey:n,dbUrl:i,dbName:s,accessKey:o,maxRetries:a=7,uglify:c,path:h,disableCache:l,command:u={}}=e,{find:f}=u,{disableAuth:d}=t||{},p=nl({...e,countDoc:!0},t);await Oe(),fh(t,["excludeFields","returnOnly","extraction","episode","retrieval","disableMinimizer"]),dh(f||{}),ph(h);let y=0;const _=()=>new Promise((async(e,t)=>{++y;const u=(r,n)=>{isNaN(r)?t(n):e(r)};try{!d&&await Ce(r)&&await ui(r);const[e,[t]]=Ne({body:{commands:{path:h,find:f},dbName:s,dbUrl:i},accessKey:o,...d?{}:{authToken:Ee.AuthJWTToken[r]},serverE2E_PublicKey:n,uglify:c}),a=await(await fetch(ul(r,c),e)).json();if(a.simpleError)throw a;const y=c?ce(a.e2e,n,t):a;l||Kh(ke.DatabaseCountResult,[r,i||de,s||fe,p],y.result),u(y.result)}catch(e){const t=Kh(ke.DatabaseCountResult,[r,i||de,s||fe,p]);if(e?.simpleError)u(void 0,e.simpleError);else if(l||isNaN(t))if(y>a)u(void 0,{error:"retry_limit_exceeded",message:`retry exceed limit(${a})`});else{const e=se((t=>{t&&(e(),_().then((e=>{u(e)}),(e=>{u(void 0,e)})))}),r)}else u(t)}}));return await _()},vl=async(e,t)=>{const{projectUrl:r,serverE2E_PublicKey:n,dbUrl:i,dbName:s,accessKey:o,maxRetries:a=7,path:c,disableCache:h,uglify:l,command:u}=e,{find:f,findOne:d,sort:p,direction:y,limit:_,random:g}=u,{retrieval:m=ye.DEFAULT,episode:v=0,disableAuth:b,disableMinimizer:w}=t||{},E=!w,k=nl(e,t),S=`${k}${r}${i}${s}${m}`,A=()=>rl(e,k),T=(m!==ye.DEFAULT||!h)&&m!==ye.NO_CACHE_NO_AWAIT;if(await Oe(),T&&(fh(t),ph(c),dh(d||f),"number"==typeof _&&(!te(_)||_<=0)))throw`limit() has an invalid argument for "${c}", expected a positive whole number but got ${_}`;let O,x=0;const C=()=>new Promise((async(h,w)=>{const N=1===++x,R=(e,t)=>{const r=N&&e?e.liveResult||null===e.liveResult?e.liveResult||void 0:e.episode[v]:e;e?h(N?r:e):w(t),!O&&N&&(O=!0,E&&((Ee.PendingDbReadCollective.pendingResolution[S]||[]).forEach((n=>{n(e?{result:ie(r)}:void 0,t)})),Ee.PendingDbReadCollective.pendingResolution[S]&&delete Ee.PendingDbReadCollective.pendingResolution[S],Ee.PendingDbReadCollective.pendingProcess[S]&&delete Ee.PendingDbReadCollective.pendingProcess[S]))};try{if(N){if(E){if(Ee.PendingDbReadCollective.pendingProcess[S])return Ee.PendingDbReadCollective.pendingResolution[S]||(Ee.PendingDbReadCollective.pendingResolution[S]=[]),void Ee.PendingDbReadCollective.pendingResolution[S].push(((e,t)=>{e?h(e.result):w(t)}));Ee.PendingDbReadCollective.pendingProcess[S]=!0}if(m.startsWith("sticky")&&await A()&&(R({episode:await A()}),m!==ye.STICKY_RELOAD))return}!b&&await Ce(r)&&await ui(r);const[a,[v]]=Ne({body:{commands:{config:t,path:c,find:d||f,sort:p,direction:y,limit:_,random:g},dbName:s,dbUrl:i},accessKey:o,authToken:b?void 0:Ee.AuthJWTToken[r],serverE2E_PublicKey:n,uglify:l}),O=await(await fetch((d?fl:dl)(r,l),a)).json();if(O.simpleError)throw O;const x=l?ce(O.e2e,n,v):O;T&&tl(e,k,{...u,config:t},x.result),R({liveResult:x.result||null})}catch(e){if(e?.simpleError)R(void 0,e?.simpleError);else if(m===ye.CACHE_NO_AWAIT&&!await A()||m===ye.STICKY_NO_AWAIT||m===ye.NO_CACHE_NO_AWAIT)R(void 0,Z(e).simpleError);else if(T&&(m===ye.DEFAULT||m===ye.CACHE_NO_AWAIT)&&await A())R({episode:await A()});else if(x>a)R(void 0,{error:"retry_limit_exceeded",message:`retry exceed limit(${a})`});else{const e=se((t=>{t&&(e(),C().then((e=>{R(e)}),(e=>{R(void 0,e)})))}),r)}}}));return await C()},bl=async(e,t,r,n)=>{const{projectUrl:i,serverE2E_PublicKey:s,dbUrl:o,dbName:a,accessKey:c,maxRetries:h=7,path:l,find:u,disableCache:f,uglify:d}=e,{disableAuth:p,delivery:y=_e.DEFAULT,stepping:_}=n||{},g=`${Date.now()+ ++Ee.PendingIte}`,m="batchWrite"===r,v=(y!==_e.DEFAULT||!f)&&y!==_e.NO_CACHE&&y!==_e.NO_AWAIT_NO_CACHE&&y!==_e.AWAIT_NO_CACHE;await Oe(),v&&(ph(l),((e,t,r)=>{const n=ee(e);if("setOne"!==r&&"setMany"!==r){if("deleteOne"!==r&&"deleteMany"!==r&&!n)throw`expected raw object in ${r}() operation but got ${e}`;dh(t),re(e,[]).forEach((([e])=>{if(e.filter((e=>"_foreign_doc"===e)).length)throw'"_foreign_doc" is a reserved word, don\'t use it as a field in a document'}))}else{if("setOne"===r&&!n)throw`expected raw object in ${r}() operation but got ${e}`;if("setMany"===r&&!Array.isArray(e))throw`expected an array of document in ${r}() operation but got ${e}`;const t={};(Array.isArray(e)?e:[e]).forEach((e=>{if(!ee(e))throw`expected raw object in ${r}() operation but got ${e}`;if(t[e._id])throw`duplicate document _id:${e._id} found in ${r}() operation`;if(!e._id)throw`No _id found in ${r}() operation`;t[e._id]=!0}))}})(t,e.find,r),await(async(e,t,r)=>{await Oe();const{projectUrl:n,dbUrl:i=de,dbName:s=fe,path:o}=e,{value:a,find:c,type:h}=r,l="updateOne"===h||"updateMany"===h||"mergeOne"===h||"mergeMany"===h,u=qo(ke.DatabaseStore,[n,i,s,o,"data"],{});let f=[],d={};Object.entries(u).forEach((([e,t])=>{let r,n=[];if("setOne"===h||"setMany"===h?("setOne"===h?[a]:a).forEach((e=>{-1===t.findIndex((t=>t._id===e._id))?n.push({doc:il(e),dex:"push",docId:a._id}):d[e._id]||console.error(`document with _id=${e._id} already exist locally with ${h}() operation, will try committing it online`),d[e._id]=!0})):t.forEach(((e,t)=>{if(r)return;let i;if(yh(e,c||{}))if("deleteMany"===h)i=null;else if("deleteOne"===h)i=null,r=!0;else if(l){if((sl({},{...a})?._id||c?._id)&&h.endsWith("Many"))throw`avoid providing "_id" for ${h}() operation, use ${h.substring(0,h.length-4)}One instead as _id only reference a single document`;i=sl({...e},{...a}),h.endsWith("One")&&(r=!0)}else i=il({...a}),r=!0;void 0!==i&&n.push({doc:i,dex:t,docId:e._id,b4Doc:{...e}})})),!n.length){let e;if("putOne"===h){const t=il(a),r=t?._id||c?._id;r?n.push({doc:{...t,_id:r},dex:"push",docId:r}):e=!0}else if("mergeOne"===h||"mergeMany"===h){const t=sl({},a),r=t?._id||c?._id;if(r&&"mergeMany"===h)throw'avoid providing "_id" for mergeMany() operation, use mergeOne instead as _id only reference a single document';r?n.push({doc:{...t,_id:r},dex:"push",docId:r}):e=!0}e&&console.error(`no data found locally and _id was not provided for ${h}() operation, skipping local and proceeding to online commit`)}f.push([e,n])})),f.forEach((([e,t])=>{t.forEach((({doc:t,dex:r,docId:n})=>{"push"===r?u[e].push({...t}):u[e]=null===t?u[e].filter((e=>e._id!==n)):u[e].map((e=>e._id===n?{...t}:e))}))})),Kh(ke.PendingWrites,[n,`${i}${s}${o}`,t],{find:c,value:a,type:h,editions:f,addedOn:Date.now()}),Ae()})(e,g,{value:t,type:r,find:u}));let b,w=0;const E=()=>new Promise((async(n,f)=>{const k=1===++w,S=(t,r,i)=>{const{removeCache:s,revertCache:o}=i||{};k||(t&&(t={a:t,c:i}),r&&(r={b:r,c:i})),t?n(t):f(r),!b&&k&&(b=!0,s&&v&&(async(e,t,r)=>{await Oe();const{projectUrl:n,dbUrl:i=de,dbName:s=fe,path:o}=e,a=qo(ke.PendingWrites,[n,`${i}${s}${o}`,t]),c=qo(ke.DatabaseStore,[n,i,s,o,"data"]);a&&(r&&c&&a.editions.forEach((([e,t])=>{t.forEach((({doc:t,dex:r,docId:n,b4Doc:i})=>{c[e]="push"===r?c[e].filter((e=>e._id!==n)):null===t?[...c[e],i]:c[e].map((e=>e._id===n?{...i}:e))}))})),el(ke.PendingWrites,[n,`${i}${s}${o}`,t]),Ae())})(e,g,o))};try{!p&&await Ce(i)&&await ui(i);const[e,[n]]=Ne({body:{commands:{value:t,...m?{stepping:_}:{path:l,scope:r,find:u}},dbName:a,dbUrl:o},accessKey:c,serverE2E_PublicKey:s,authToken:p?void 0:Ee.AuthJWTToken[i],uglify:d}),h=await(await fetch((m?yl:pl)(i,d),e)).json();if(h.simpleError)throw h;const f=d?ce(h.e2e,s,n):h;S({status:"sent",committed:f.committed},void 0,{removeCache:!0})}catch(e){if(e?.simpleError)console.error(`${r} error (${l}), ${e.simpleError?.message}`),S(void 0,e?.simpleError,{removeCache:!0,revertCache:!0});else if(y===_e.NO_AWAIT||y===_e.CACHE_NO_AWAIT||y===_e.NO_AWAIT_NO_CACHE||y===_e.NO_CACHE)S(void 0,Z(e).simpleError,await Ce(i)?{removeCache:!0}:null);else if(w>h)S(void 0,{error:"retry_limit_exceeded",message:`retry exceed limit(${h})`});else if(y===_e.AWAIT_NO_CACHE){const e=se((t=>{t&&(e(),E().then((e=>{S(e.a,void 0,e.c)}),(e=>{S(void 0,e.b,e.c)})))}),i)}else v?S({status:"pending"}):S(void 0,Z(e).simpleError)}}));return await E()};class wl{constructor(e){this.builder={...e}}uploadFile=(t,r,n,i,s)=>{let o,a=!1,c=!1;return(async()=>{let h,l;if(e.Buffer.isBuffer(t))l=t;else if(t instanceof Blob)try{l=await t.arrayBuffer()}catch(e){return void n?.({error:"invalid_blob",message:`uploadFile() first argument has an invalid blob ${e}`})}else{if("string"!=typeof t||!t?.trim())return void n?.({error:"file_path_invalid",message:"uploadFile() first argument must either be a blob, buffer or base64 string"});h=t.replace(/^data:\w+\/\w+;base64,/,"")}if(a)return;r=r?.trim();const u=kl(r);if(u)return void n?.({error:"destination_invalid",message:u});const{projectUrl:f,accessKey:d}=this.builder;o=new XMLHttpRequest;const{awaitServer:p}=s||{};p&&await xe(f),await ui(f),o.open("POST",ni._uploadFile(f),!0),o.upload.addEventListener("progress",(e=>{i?.({sentBtyes:e.loaded,totalBytes:e.total})})),o.addEventListener("load",(()=>{if(!c&&!a){c=!0;try{const e=JSON.parse(o.responseText);if("success"!==e.status||!e.downloadUrl)throw e.simpleError||{error:"unexpected_error",message:"An unexpected error occurred"};n?.(void 0,e.downloadUrl)}catch(e){n?.(e)}}})),o.addEventListener("error",(()=>{c||a||(c=!0,n?.({error:"unexpected_error",message:"An unexpected error occurred"}))})),o.addEventListener("abort",(()=>{c||a||(c=!0,n?.({error:"upload_aborted",message:"The upload process was aborted"}))})),o.setRequestHeader("Authorization",`Bearer ${he(d)}`),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Content-Type",l?"buffer/upload":"text/plain"),Ee.AuthJWTToken[f]&&o.setRequestHeader("Mosquito-Token",Ee.AuthJWTToken[f]),o.setRequestHeader("Mosquito-Destination",r),h&&o.setRequestHeader("Mosquito-Encoding","base64"),o.send(h||l)})(),()=>{a||(a=!0,o&&o.abort(),setTimeout((()=>{n?.({error:"upload_aborted",message:"The upload process was aborted"})}),1))}};deleteFile=e=>El(this.builder,e);deleteFolder=e=>El(this.builder,e,!0)}const El=async(e,t,r)=>{const{projectUrl:n,accessKey:i}=e;try{const e=await(await fetch(ni[r?"_deleteFolder":"_deleteFile"](n),Ne({path:t},Ee.AuthJWTToken[n]))).json();if(e.simpleError)throw e;if("success"!==e.status)throw"operation not successful"}catch(e){if(e?.simpleError)throw e.simpleError;throw Re("unexpected_error",`${e}`).simpleError}},kl=(e="")=>{if(!(e=e.trim())||"string"!=typeof e)return"destination is required";if(e.startsWith("/")||e.endsWith("/"))return'destination must neither start with "/" nor end with "/"';let t,r="";return e.split("").forEach((e=>{"/"===e&&"/"===r&&(t='invalid destination path, "/" cannot be side by side'),r=e})),t},Sl=t=>{const{ok:r,type:n,status:i,statusText:s,redirected:o,url:a,headers:c,base64:h,builderCred:l}=t,{uglified:u,encKey:f,serverKey:d}=l,p={arrayBuffer:async()=>e.Buffer.from(h,"base64"),json:async()=>JSON.parse(await p.text()),text:async()=>{const t=e.Buffer.from(h,"base64").toString("utf8");if(u){return`${ce(t,d,f)}`}return t},clone:()=>({...p}),type:n,status:i,statusText:s,redirected:o,url:a,ok:r,headers:new Headers({...c})};return p},Al=(e="",t)=>{let r;return Object.entries(t||{}).forEach((([t,n])=>{t.toLowerCase()===e.toLowerCase()&&(r=n)})),r},Tl=e=>{const t={};return e.forEach(((e,r)=>{t[r]=e})),t};var Ol=function e(t){if(void 0===t)return t;if(t&&Buffer.isBuffer(t))return JSON.stringify(":base64:"+t.toString("base64"));if(t&&t.toJSON&&(t=t.toJSON()),t&&"object"==typeof t){var r="",n=Array.isArray(t);r=n?"[":"{";var i=!0;for(var s in t){var o="function"==typeof t[s]||!n&&void 0===t[s];Object.hasOwnProperty.call(t,s)&&!o&&(i||(r+=","),i=!1,n?null==t[s]?r+="null":r+=e(t[s]):void 0!==t[s]&&(r+=e(s)+":"+e(t[s])))}return r+=n?"]":"}"}return"string"==typeof t?JSON.stringify(/^:/.test(t)?":"+t:t):void 0===t?"null":JSON.stringify(t)},xl=function(e){return JSON.parse(e,(function(e,t){return"string"==typeof t?/^:base64:/.test(t)?Buffer.from(t.substring(8),"base64"):/^:/.test(t)?t.substring(1):t:t}))};const{_listenCollection:Cl,_listenDocument:Nl,_startDisconnectWriteTask:Rl,_cancelDisconnectWriteTask:$l,_listenUserVerification:Pl}=ni;const Bl=e=>{const t=[...Object.values(pe)];Object.entries(e).forEach((([e,r])=>{if("cachePassword"===e){if("string"!=typeof r||r.trim().length<=0)throw"Invalid value supplied to cachePassword, value must be a string and greater than 0 characters"}else{if("cacheProtocol"!==e)throw`Unexpected property named ${e}`;if(!t.includes(`${r}`))throw`unknown value supplied to ${e}, expected any of ${t}`}}))},Ll={dbName:e=>{if("string"!=typeof e||!e.trim())throw"Invalid value supplied to dbName, value must be string and greater than one"},dbUrl:e=>{if("string"!=typeof e||!e.trim())throw"Invalid value supplied to dbUrl, value must be string and greater than one"},heapMemory:e=>{if("number"!=typeof e||e<=0)throw"Invalid value supplied to heapMemory, value must be number and greater than zero"},projectUrl:e=>{if("string"!=typeof e||!we().test(e.trim()))throw"Invalid value supplied to projectUrl, value must be a string and greater than one"},disableCache:e=>{if("boolean"!=typeof e)throw"Invalid value supplied to disableCache, value must be a boolean"},accessKey:e=>{if("string"!=typeof e||!e.trim())throw"Invalid value supplied to accessKey, value must be a string and greater than one"},maxRetries:e=>{if("number"!=typeof e||e<=0||!te(e))throw"Invalid value supplied to maxRetries, value must be whole number and greater than zero"},enableE2E_Encryption:e=>{if("boolean"!=typeof e)throw"Invalid value supplied to enableE2E_Encryption, value must be a boolean"},serverE2E_PublicKey:e=>{if("string"!=typeof e||!e.trim())throw"Invalid value supplied to serverETE_PublicKey, value must be string and greater than one"}},Ul=(e,t)=>{if("object"!=typeof e)throw`${t.constructor.name} config is not an object`;const r=Object.keys(e);for(let t=0;t<r.length;t++){const n=r[t];if(!Ll[n])throw`Unexpected property named ${n}`;Ll[n](e[n])}if(e.enableE2E_Encryption&&!e.serverE2E_PublicKey)throw'"serverE2E_PublicKey" is missing, enabling end-to-end encryption requires a public encryption key from the server';if(!e.projectUrl)throw`projectUrl is a required property in ${t.constructor.name}() constructor`;if(!e.accessKey)throw`accessKey is a required property in ${t.constructor.name}() constructor`};exports.DOCUMENT_EXTRACTION=e=>({$dynamicValue:e}),exports.FIND_GEO_JSON=(e,t,r)=>({$near:{$geometry:{type:"Point",coordinates:e.reverse()},$minDistance:r||0,$maxDistance:t}}),exports.GEO_JSON=(e,t)=>({type:"Point",coordinates:[t,e]}),exports.MosquitoTransport=class{constructor(e){Ul(e,this),this.config={...e,uglify:e.enableE2E_Encryption,apiUrl:e.projectUrl,projectUrl:e.projectUrl.split("/").slice(0,-1).join("/")};const{projectUrl:t}=this.config;if(this.config.secureUrl=t.startsWith("https"),this.config.baseUrl=t.split("://")[1],this.config.wsPrefix=this.config.secureUrl?"wss":"ws",!Ee.ReleaseCacheData)throw`releaseCache must be called before creating any ${this.constructor.name} instance`;if(!Ee.InitializedProject[t]){Ee.InitializedProject[t]=!0,Ee.LastTokenRefreshRef[t]=0,li(t),fi({...this.config},!0);const e=ti(`${this.config.wsPrefix}://${t.split("://")[1]}`,{transports:["websocket","polling","flashsocket"],auth:{_m_internal:!0,_from_base:!0}});e.on("_signal_signout",(()=>{this.auth().signOut()})),e.on("connect",(()=>{g.dispatch(t,!0)})),e.on("disconnect",(()=>{g.dispatch(t,!1)})),se((e=>{Ee.IS_CONNECTED[t]=e}),t),y.listenTo(t,(e=>{Ee.IS_TOKEN_READY[t]=e}))}}static releaseCache(e){if(Ee.ReleaseCacheData)throw`calling ${this.name}() multiple times is prohibited`;Bl({...e}),Ee.ReleaseCacheData={...e},Te({...e})}getDatabase=(e,t)=>({collection:r=>new ol({...this.config,path:r,...e?{dbName:e}:{},...t?{dbUrl:t}:{}})});collection=e=>(ph(e),new ol({...this.config,path:e}));batchWrite=(e,t)=>((e,t,r)=>bl({...e},t,"batchWrite",r))({...this.config},e,t);auth=()=>new bi({...this.config});storage=()=>new wl({...this.config});fetchHttp=(t,r,n)=>(async(t="",r={},n)=>{const{projectUrl:i,apiUrl:s,serverE2E_PublicKey:o,method:a,maxRetries:c=7,disableCache:h,accessKey:l,uglify:u}=n,{retrieval:f=ye.DEFAULT,enableMinimizer:d,rawApproach:p}=a||{},y=we().test(t),_=a?.disableAuth||y,g=(f!==ye.DEFAULT||!h)&&f!==ye.NO_CACHE_NO_AWAIT,m=ne({...r,jij:{disableAuth:!!_,url:t,projectUrl:i,retrieval:f}});if("mtoken"in(r?.headers||{}))throw'"mtoken" in header is a reserved prop';if("uglified"in(r?.headers||{}))throw'"uglified" in header is a reserved prop';if(t.startsWith(i)&&!p)throw`fetchHttp first argument can not starts with projectUrl:"${i}", please set {rawApproach: true} if you're trying to access this url as it is`;if(!y&&r.body&&"string"!=typeof r.body)throw'"body" must be a string value';let v,b=0;const w=()=>new Promise((async(n,a)=>{const h=++b,p=(e,t)=>{e?n(e):a(t),v||1!==h||(v=!0,d&&((Ee.PendingFetchCollective.pendingResolution[m]||[]).forEach((r=>{r(ie(e),t)})),Ee.PendingFetchCollective.pendingResolution[m]&&delete Ee.PendingFetchCollective.pendingResolution[m],Ee.PendingFetchCollective.pendingProcess[m]&&delete Ee.PendingFetchCollective.pendingProcess[m]))};await Oe();const E=ke.FetchedStore[m],k=()=>{p({...Sl(E),fromCache:!0})};try{if(1===h){if(d){if(Ee.PendingFetchCollective.pendingProcess[m])return Ee.PendingFetchCollective.pendingResolution[m]||(Ee.PendingFetchCollective.pendingResolution[m]=[]),void Ee.PendingFetchCollective.pendingResolution[m].push(((e,t)=>{e?n(e.result):a(t)}));Ee.PendingFetchCollective.pendingProcess[m]=!0}if(f.startsWith("sticky")&&E&&(k(),f!==ye.STICKY_RELOAD))return}!_&&await Ce(i)&&await ui(i);const c=Ee.AuthJWTToken[i],v=!y&&r?.body&&"string"==typeof r?.body&&u,b=Al("content-type",r?.headers),[w,[S]]=v&&y?ae(r.body,c,o):[null,[]],A=await fetch(y?t:`${s}/${t}`,{...y?{}:{method:"POST"},...r,...v?{body:w}:{},cache:"no-cache",headers:{...y?{}:{"Content-type":"application/json"},...r?.headers,...v?{uglified:v,"Content-type":"text/plain",...b?{"init-content-type":b}:{}}:{},..._||!c||v||y?{}:{mtoken:c},...y?{}:{authorization:`Bearer ${l}`}}}),{ok:T,type:O,status:x,statusText:C,redirected:N,url:R,headers:$}=A,P=$.get("simple_error");if(!y&&P)throw{simpleError:JSON.parse(P)};const B=e.Buffer.from(await A.arrayBuffer()).toString("base64"),L={builderCred:{uglified:v,encKey:S,serverKey:o},base64:B,type:O,status:x,statusText:C,redirected:N,url:R,ok:T,headers:Tl($)};g&&(ke.FetchedStore[m]={...L},Ae()),p(Sl(L))}catch(e){if(e?.simpleError)p(void 0,e.simpleError);else if(f===ye.CACHE_NO_AWAIT&&!E||f===ye.STICKY_NO_AWAIT||f===ye.NO_CACHE_NO_AWAIT)p(void 0,Z(e).simpleError);else if(g&&(f===ye.DEFAULT||f===ye.CACHE_NO_AWAIT)&&E)k();else if(b>=c)p(void 0,Z(e).simpleError);else{const e=se((async t=>{t&&(e(),w().then((e=>{1===h?p(e):n(e)}),(e=>{1===h?p(void 0,e):a(e)})))}),i)}}}));return await w()})(t,r,{...this.config,method:n});listenReachableServer=e=>se(e,this.config.projectUrl);getSocket=e=>{const{disableAuth:t,authHandshake:r}=e||{},{projectUrl:n,uglify:i,accessKey:s,serverE2E_PublicKey:o,wsPrefix:a}=this.config,c=[Cl,Nl,Rl,$l,Pl];let h,l,u,f,d,p=()=>new Promise((e=>{h=e})),_=p(),g=[],m=0;const v=e=>function(){const[t,...r]=[...arguments];let n;n=i?xl(ce(t,o,d)):t,e?.(...n||[],..."function"==typeof r[0]?[function(){const e=[...arguments];let t;t=i?ae(Ol(e),void 0,o)[0]:e,r[0](t)}]:[])},b=({timeout:e,promise:t,emittion:r})=>new Promise((async(n,s)=>{const[a,...h]=r;if("string"!=typeof a)throw`expected ${t?"emitWithAck":"emit"} first argument to be a string type`;if(c.includes(a))throw`${a} is a restricted socket path, avoid using any of ${c}`;let l,f=Date.now();const d=isNaN(e)?void 0:setTimeout((()=>{l=!0,s(new Error("emittion timeout"))}),e);if(await _,!l){clearTimeout(d);try{const r=isNaN(e)?u:u.timeout(e-(Date.now()-f)),s=h.slice(-1)[0],c="function"==typeof s?h.slice(0,-1):h,[l,[d]]=i?ae(Ol(c),void 0,o):[void 0,[]];if("function"==typeof s&&t)throw"emitWithAck cannot have function in it parameter";const p=await r[t?"emitWithAck":"emit"](a,...i?[l]:[c],..."function"==typeof s?[function(){const e=[...arguments][0];let t;t=i?xl(ce(e,o,d)):e,s(...t||[])}]:[]);n(t&&p?i?xl(ce(p,o,d))[0]:p[0]:void 0)}catch(e){s(e)}}})),w=async()=>{if(l)return;const e=t?void 0:Ee.AuthJWTToken[n],[c,[f]]=i?ae({accessKey:s,a_extras:r},e,o):[null,[]];u=ti(`${a}://${n.split("://")[1]}`,{transports:["websocket","polling","flashsocket"],auth:i?{ugly:!0,e2e:c}:{...e?{mtoken:e}:{},a_extras:r,accessKey:s}}),d=f,h(),g.forEach((([e,t,r,n])=>{u[t](r,n)}))};if(t)w();else{let e;f=((e,t)=>y.listenTo(t,e,!0))((t=>{e!==(t||!1)&&("ready"===t?w():(u?.close?.(),u=void 0,_=p()),e=t||!1)}),n)}return{timeout:e=>({emitWithAck:function(){return b({timeout:e,promise:!0,emittion:[...arguments]})}}),emit:function(){b({emittion:[...arguments]})},emitWithAck:function(){return b({emittion:[...arguments],promise:!0})},on:async(e,t)=>{if(c.includes(e))throw`${e} is a restricted socket path, avoid using any of ${c}`;const r=++m,n=v(t);return g.push([r,"on",e,n]),u&&u.on(e,n),()=>{u&&u.off(e,n),g=g.filter((([e])=>e!==r))}},once:async(e,t)=>{if(c.includes(e))throw`${e} is a restricted socket path, avoid using any of ${c}`;const r=++m,n=v(t);return g.push([r,"once",e,n]),u&&u.once(e,n),()=>{u&&u.off(e,n),g=g.filter((([e])=>e!==r))}},destroy:()=>{l=!0,f?.(),u&&u.close(),g=[]}}};wipeDatabaseCache=()=>{}},exports.TIMESTAMP={$timestamp:"now"};
//# sourceMappingURL=index.js.map
